<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>SCION Data Plane</title>
<meta content="Corine de Kater" name="author">
<meta content="Nicola Rustignoli" name="author">
<meta content="Samuel Hitz" name="author">
<meta content="
       This document describes the data plane of the path-aware, inter-domain network architecture SCION (Scalability, Control, and Isolation On Next-generation networks). One of the basic characteristics of SCION is that it gives path control to endpoints. The SCION control plane is responsible for discovering these paths and making them available as path segments to the endpoints. The responsibility of the  SCION data plane  is to combine the path segments into end-to-end paths, and forward data between endpoints according to the specified path. 
       The SCION data plane fundamentally differs from today's IP-based data plane in that it is  path-aware : In SCION, interdomain forwarding directives are embedded in the packet header. This document first provides a detailed specification of the SCION data packet format as well as the structure of the SCION header. SCION also supports extension headers - these are described, too. The document then shows the life cycle of a SCION packet while traversing the SCION Internet. This is followed by a specification of the SCION path authorization mechanisms and the packet processing at routers. 
    " name="description">
<meta content="xml2rfc 3.21.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-dekater-scion-dataplane-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.21.0
    Python 3.11.9
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.2.1
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.13
-->
<link href="draft-dekater-scion-dataplane.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">SCION DP</td>
<td class="right">June 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">de Kater, et al.</td>
<td class="center">Expires 7 December 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-dekater-scion-dataplane-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-06-05" class="published">5 June 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-12-07">7 December 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. de Kater</div>
<div class="org">SCION Association</div>
</div>
<div class="author">
      <div class="author-name">N. Rustignoli</div>
<div class="org">SCION Association</div>
</div>
<div class="author">
      <div class="author-name">S. Hitz</div>
<div class="org">Anapaya Systems</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">SCION Data Plane</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes the data plane of the path-aware, inter-domain network architecture SCION (Scalability, Control, and Isolation On Next-generation networks). One of the basic characteristics of SCION is that it gives path control to endpoints. The SCION control plane is responsible for discovering these paths and making them available as path segments to the endpoints. The responsibility of the <strong>SCION data plane</strong> is to combine the path segments into end-to-end paths, and forward data between endpoints according to the specified path.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">The SCION data plane fundamentally differs from today's IP-based data plane in that it is <em>path-aware</em>: In SCION, interdomain forwarding directives are embedded in the packet header. This document first provides a detailed specification of the SCION data packet format as well as the structure of the SCION header. SCION also supports extension headers - these are described, too. The document then shows the life cycle of a SCION packet while traversing the SCION Internet. This is followed by a specification of the SCION path authorization mechanisms and the packet processing at routers.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://scionassociation.github.io/scion-dp_I-D/draft-dekater-scion-dataplane.html">https://scionassociation.github.io/scion-dp_I-D/draft-dekater-scion-dataplane.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-dekater-scion-dataplane/">https://datatracker.ietf.org/doc/draft-dekater-scion-dataplane/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/scionassociation/scion-dp_I-D">https://github.com/scionassociation/scion-dp_I-D</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 7 December 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3.2.1">
                    <p id="section-toc.1-1.1.2.3.2.1.1" class="keepWithNext"><a href="#section-1.3.1" class="auto internal xref">1.3.1</a>.  <a href="#name-inter-and-intra-domain-forw" class="internal xref">Inter- and Intra-Domain Forwarding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3.2.2">
                    <p id="section-toc.1-1.1.2.3.2.2.1"><a href="#section-1.3.2" class="auto internal xref">1.3.2</a>.  <a href="#name-intra-domain-forwarding-pro" class="internal xref">Intra-Domain Forwarding Process</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3.2.3">
                    <p id="section-toc.1-1.1.2.3.2.3.1"><a href="#section-1.3.3" class="auto internal xref">1.3.3</a>.  <a href="#name-configuration" class="internal xref">Configuration</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="auto internal xref">1.4</a>.  <a href="#name-path-construction-segment-c" class="internal xref">Path Construction (Segment Combinations)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.5">
                <p id="section-toc.1-1.1.2.5.1"><a href="#section-1.5" class="auto internal xref">1.5</a>.  <a href="#name-path-authorization" class="internal xref">Path Authorization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-scion-header-specification" class="internal xref">SCION Header Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-scion-packet-header-format" class="internal xref">SCION Packet Header Format</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-header-alignment" class="internal xref">Header Alignment</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-scion-header-structure" class="internal xref">SCION Header Structure</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="auto internal xref">2.2.1</a>.  <a href="#name-common-header" class="internal xref">Common Header</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="auto internal xref">2.2.2</a>.  <a href="#name-address-header" class="internal xref">Address Header</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="auto internal xref">2.2.3</a>.  <a href="#name-path-header" class="internal xref">Path Header</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-extension-headers" class="internal xref">Extension Headers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="auto internal xref">2.3.1</a>.  <a href="#name-format-of-the-scion-options" class="internal xref">Format of the SCION Options Headers</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-upper-layer-protocol-issues" class="internal xref">Upper-Layer Protocol Issues</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.1">
                    <p id="section-toc.1-1.2.2.4.2.1.1"><a href="#section-2.4.1" class="auto internal xref">2.4.1</a>.  <a href="#name-pseudo-header-for-upper-lay" class="internal xref">Pseudo Header for Upper-Layer Checksum</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-life-of-a-scion-data-packet" class="internal xref">Life of a SCION Data Packet</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-description" class="internal xref">Description</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-creating-an-end-to-end-scio" class="internal xref">Creating an End-to-End SCION Forwarding Path</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-step-by-step-explanation" class="internal xref">Step-by-Step Explanation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-path-authorization-2" class="internal xref">Path Authorization</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-authorizing-segments-throug" class="internal xref">Authorizing Segments through Chained MACs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-hop-field-mac-computation" class="internal xref">Hop Field MAC Computation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-peering-links" class="internal xref">Peering Links</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-path-initialization-and-pac" class="internal xref">Path Initialization and Packet Processing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-initialization-at-source-en" class="internal xref">Initialization at Source Endpoint</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-processing-at-routers" class="internal xref">Processing at Routers</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-path-authorization-3" class="internal xref">Path Authorization</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-forwarding-key-compromise" class="internal xref">Forwarding key compromise</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-forging-hop-field-mac" class="internal xref">Forging hop field MAC</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-path-splicing" class="internal xref">Path Splicing</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-on-path-attacks" class="internal xref">On-Path Attacks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-modification-of-the-path-he" class="internal xref">Modification of the Path Header</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-off-path-attacks" class="internal xref">Off-Path Attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-volumetric-denial-of-servic" class="internal xref">Volumetric Denial of Service Attacks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-assigned-scion-protocol-num" class="internal xref">Assigned SCION Protocol Numbers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#appendix-B.1" class="auto internal xref"></a><a href="#name-considerations" class="internal xref">Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#appendix-B.2" class="auto internal xref"></a><a href="#name-assignment" class="internal xref">Assignment</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">SCION leverages source-based path selection, where path information is embedded in the packet header - this is called packet-carried forwarding state (PCFS). This section explains how data packets are forwarded through the network, how the SCION inter-domain routing differs from intra-domain routing, and how endpoints can construct end-to-end paths from path segments. It also briefly touches the concept of path authorization, which ensures that data packets always traverse the network along authorized paths.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"><strong>Note:</strong> This is the very first version of the SCION Data Plane document. We are aware that the draft is far from perfect, and hope to improve the content in later versions of the document. To reach this goal, any feedback is welcome and much appreciated. Thanks!<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"><strong>Note:</strong> It is assumed that readers of this draft are familiar with the basic concepts of the SCION next-generation inter-domain network architecture. If not, please find more detailed information in the IETF Internet Drafts <span>[<a href="#I-D.scion-overview" class="cite xref">I-D.scion-overview</a>]</span>, <span>[<a href="#I-D.scion-components" class="cite xref">I-D.scion-components</a>]</span>, <span>[<a href="#I-D.scion-cppki" class="cite xref">I-D.scion-cppki</a>]</span>, and <span>[<a href="#I-D.scion-cp" class="cite xref">I-D.scion-cp</a>]</span>, as well as in <span>[<a href="#CHUAT22" class="cite xref">CHUAT22</a>]</span>, especially Chapter 2. A short description of the SCION basic terms and elements can be found in <a href="#terms" class="auto internal xref">Section 1.1</a> below.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="terms">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1"><strong>Autonomous System (AS)</strong>: An autonomous system is a network under a common administrative control. For example, the network of an Internet service provider, company, or university can constitute an AS.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2"><strong>Core AS</strong>: Each SCION isolation domain (ISD) is administered by a set of distinguished autonomous systems (ASes) called core ASes, which are responsible for initiating the path-discovery and -construction process (in SCION called "beaconing").<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3"><strong>Data Plane</strong>: The data plane (sometimes also referred to as the forwarding plane) is responsible for forwarding data packets that endpoints have injected into the network. After routing information has been disseminated by the control plane, packets are forwarded according to such information by the data plane.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4"><strong>Endpoint</strong>: An endpoint is the start- or the end of a SCION path. For example, an endpoint can be a host as defined in <span>[<a href="#RFC1122" class="cite xref">RFC1122</a>]</span>, or a gateway bridging a SCION and an IP domain. This definition is based on the definition in <span>[<a href="#RFC9473" class="cite xref">RFC9473</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5"><strong>Forwarding Key</strong>: A forwarding key is a symmetric key that is shared between the control service (control plane) and the routers (data plane) of an AS. It is used to authenticate hop fields in the end-to-end SCION path. The forwarding key is an AS-local secret and is not shared with other ASes.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6"><strong>Forwarding Path</strong>: A forwarding path is a complete end-to-end path between two SCION hosts, which is used to transmit packets in the data plane and can be created with a combination of up to three path segments (an up-segment, a core-segment, and a down-segment).<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<p id="section-1.1-7"><strong>Hop Field (HF)</strong>: As they traverse the network, path-segment construction beacons (PCBs) accumulate cryptographically protected AS-level path information in the form of hop fields. In the data plane, hop fields are used for packet forwarding: they contain the incoming and outgoing interface IDs of the ASes on the forwarding path.<a href="#section-1.1-7" class="pilcrow">¶</a></p>
<p id="section-1.1-8"><strong>Info Field (INF)</strong>: Each path-segment construction beacon (PCB) contains a single info field, which provides basic information about the PCB. Together with hop fields (HFs), info fields are used to create forwarding paths.<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<p id="section-1.1-9"><strong>Interface Identifier (Interface ID)</strong>: 16 bit identifier that designates a SCION interface at the end of a link connecting two SCION ASes. Each interface belongs to one border router. Hop fields describe the traversal of an AS by a pair of interface IDs (the ingress and egress interfaces). The Interface ID <span class="bcp14">MUST</span> be unique within each AS. Interface ID 0 is not a valid identifier, implementations can use it as the "unspecified" value.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
<p id="section-1.1-10"><strong>Isolation Domain (ISD)</strong>: In SCION, autonomous systems (ASes) are organized into logical groups called isolation domains or ISDs. Each ISD consists of ASes that span an area with a uniform trust environment (e.g., a common jurisdiction). A possible model is for ISDs to be formed along national boundaries or federations of nations.<a href="#section-1.1-10" class="pilcrow">¶</a></p>
<p id="section-1.1-11"><strong>Leaf AS</strong>: An AS at the "edge" of an ISD, with no other downstream ASes.<a href="#section-1.1-11" class="pilcrow">¶</a></p>
<p id="section-1.1-12"><strong>MAC</strong>: Message Authentication Code. In the rest of this document, "MAC" always refers to "Message Authentication Code" and never to "Medium Access Control". When "Medium Access Control address" is implied, the phrase "Link Layer Address" is used.<a href="#section-1.1-12" class="pilcrow">¶</a></p>
<p id="section-1.1-13"><strong>Packet-Carried Forwarding State (PCFS)</strong>: Rather than relying on inter-domain forwarding tables, SCION data packets contain all the necessary, cryptographically-protected path information. This property is referred to as packet-carried forwarding state.<a href="#section-1.1-13" class="pilcrow">¶</a></p>
<p id="section-1.1-14"><strong>Path Authorization</strong>: A requirement for the data plane is that endpoints can only use paths that were constructed and authorized by ASes in the control plane. This property is called path authorization. The goal of path authorization is to prevent endpoints from crafting hop fields (HFs) themselves, modifying HFs in authorized path segments, or combining HFs of different path segments.<a href="#section-1.1-14" class="pilcrow">¶</a></p>
<p id="section-1.1-15"><strong>Path Control</strong>: Path control is a property of a network architecture that gives endpoints the ability to select how their packets travel through the network. Path control is stronger than path transparency.<a href="#section-1.1-15" class="pilcrow">¶</a></p>
<p id="section-1.1-16"><strong>Path Segment</strong>: Path segments are derived from path-segment construction beacons (PCBs). A path segment can be (1) an up-segment (i.e., a path between a non-core AS and a core AS in the same ISD), (2) a down-segment (i.e., the same as an up-segment, but in the opposite direction), or (3) a core-segment (i.e., a path between core ASes). Up to three path segments can be used to create a forwarding path.<a href="#section-1.1-16" class="pilcrow">¶</a></p>
<p id="section-1.1-17"><strong>Path-Segment Construction Beacon (PCB)</strong>: Core ASes generate PCBs to explore paths within their isolation domain (ISD) and among different ISDs. ASes further propagate selected PCBs to their neighboring ASes. As a PCB traverses the network, it carries path segments, which can subsequently be used for traffic forwarding.<a href="#section-1.1-17" class="pilcrow">¶</a></p>
<p id="section-1.1-18"><strong>Path Transparency</strong>: Path transparency is a property of a network architecture that gives endpoints full visibility over the network paths their packets are taking. Path transparency is weaker than path control.<a href="#section-1.1-18" class="pilcrow">¶</a></p>
<p id="section-1.1-19"><strong>Peering Link</strong>: A link between two SCION border routers of different ASes, where at least one of the two ASes is not core. Two peering ASes may be in different ISDs. A peering link can be seen as a short-cut on a normal path. Peering link information is added to segment information during the beaconing process and used to shorten paths while assembling them from segments.<a href="#section-1.1-19" class="pilcrow">¶</a></p>
<p id="section-1.1-20"><strong>Valley Route</strong>: A valley route contains ASes that do not profit economically from traffic on this route. The name comes from the fact that such routes go "down" (following parent-child links) before going "up" (following child-parent links).<a href="#section-1.1-20" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-1.2">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-1.3">
        <h3 id="name-overview">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-1.3-1">The SCION data plane forwards inter-domain packets between ASes. SCION routers are normally deployed at the edge of an AS, and peer with neighbor SCION routers. Inter-domain forwarding is based on end-to-end path information contained in the packet header. This path information consists of a sequence of hop fields (HFs). Each hop field corresponds to an AS on the path, and it includes an ingress- as well as an egress interface ID, which univocally identify the ingress and egress interfaces within the AS. The information is authenticated with a Message Authentication Code (MAC) to prevent forgery.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.3-2">This concept allows SCION routers to forward packets to a neighbor AS without inspecting the destination address and also without consulting an inter-domain forwarding table. Intra-domain forwarding and routing are based on existing mechanisms (e.g., IP). A SCION border router reuses existing intra-domain infrastructure to communicate to other SCION routers or SCION endpoints within its AS. The last SCION router at the destination AS therefore uses the destination address to forward the packet to the appropriate local endpoint.<a href="#section-1.3-2" class="pilcrow">¶</a></p>
<p id="section-1.3-3">This SCION design choice has the following advantages:<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-4.1">
            <p id="section-1.3-4.1.1">It provides control and transparency over forwarding paths to endpoints.<a href="#section-1.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.3-4.2">
            <p id="section-1.3-4.2.1">It simplifies the packet-processing at routers: Instead of having to perform longest-prefix matching on IP addresses, which requires expensive hardware and substantial amounts of energy, a router can simply access the next hop from the packet header, after having verified the authenticity of the hop field's MAC.<a href="#section-1.3-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="inter-and-intra-domain-forwarding">
<section id="section-1.3.1">
          <h4 id="name-inter-and-intra-domain-forw">
<a href="#section-1.3.1" class="section-number selfRef">1.3.1. </a><a href="#name-inter-and-intra-domain-forw" class="section-name selfRef">Inter- and Intra-Domain Forwarding</a>
          </h4>
<p id="section-1.3.1-1">As SCION is an inter-domain network architecture, it is not concerned with intra-domain forwarding. This corresponds to the general practice today where BGP and IP are used for inter-domain routing and forwarding, respectively, but ASes use an intra-domain protocol of their choice, for example OSPF or IS-IS for routing and IP, MPLS, and various layer-2 protocols for forwarding. In fact, even if ASes use IP-forwarding internally today, they typically encapsulate the original IP packet they receive at the edge of their network into another IP packet with the destination address set to the egress border router, to avoid full inter-domain forwarding tables at internal routers.<a href="#section-1.3.1-1" class="pilcrow">¶</a></p>
<p id="section-1.3.1-2">SCION emphasizes this separation, as SCION is used exclusively for inter-domain forwarding, and re-uses the intra-domain network fabric to provide connectivity among all SCION infrastructure services, border routers, and endpoints. As a consequence, minimal change to the infrastructure is required for ISPs when deploying SCION.<a href="#section-1.3.1-2" class="pilcrow">¶</a></p>
<p id="section-1.3.1-3">Although a complete SCION address is composed of the &lt;ISD, AS, endpoint address&gt; 3-tuple, the endpoint address is not used for inter-domain routing or forwarding. This implies that the endpoint addresses are not required to be globally unique or globally routable, they can be selected independently by the corresponding ASes. This means, for example, that an endpoint identified by a link-local IPv6 address in the source AS can directly communicate with an endpoint identified by a globally routable IPv4 address via SCION. Alternatively, it is possible for two SCION hosts with the same IPv4 address 10.0.0.42 but located in different ASes to communicate with each other via SCION (<span>[<a href="#RFC1918" class="cite xref">RFC1918</a>]</span>).<a href="#section-1.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="intra-domain-forwarding-process">
<section id="section-1.3.2">
          <h4 id="name-intra-domain-forwarding-pro">
<a href="#section-1.3.2" class="section-number selfRef">1.3.2. </a><a href="#name-intra-domain-forwarding-pro" class="section-name selfRef">Intra-Domain Forwarding Process</a>
          </h4>
<p id="section-1.3.2-1">The full forwarding process for a packet transiting an intermediate AS consists of the following steps.<a href="#section-1.3.2-1" class="pilcrow">¶</a></p>
<p id="section-1.3.2-2"><strong>Note:</strong> In this context, a border router is called <strong>ingress</strong> border router when it refers to an entrance border router to an AS, as seen from the direction of travel of the SCION packet. A border router is called <strong>egress</strong> border router when it refers to an exit border router of an AS, as seen from the direction of travel of the SCION packet.<a href="#section-1.3.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1.3.2-3">
<li id="section-1.3.2-3.1">
              <p id="section-1.3.2-3.1.1">The AS's SCION ingress router receives a SCION packet from the neighboring AS.<a href="#section-1.3.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-1.3.2-3.2">
              <p id="section-1.3.2-3.2.1">The SCION router parses, validates, and authenticates the SCION header.<a href="#section-1.3.2-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-1.3.2-3.3">
              <p id="section-1.3.2-3.3.1">The SCION router maps the egress interface ID in the current hop field of the SCION header to the destination "intra-protocol" address of the egress border router (where "intra-protocol" is the intra-domain forwarding protocol, e.g., MPLS or IP).<a href="#section-1.3.2-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-1.3.2-3.4">
              <p id="section-1.3.2-3.4.1">The packet is forwarded within the AS by routers and switches based on the "intra-protocol" header.<a href="#section-1.3.2-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-1.3.2-3.5">
              <p id="section-1.3.2-3.5.1">Upon receiving the packet, the SCION egress router strips off the "intra-protocol" header, again validates and updates the SCION header, and forwards the packet to the neighboring SCION router.<a href="#section-1.3.2-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-1.3.2-3.6">
              <p id="section-1.3.2-3.6.1">The last SCION router on the path forwards the packet to the packet's destination endpoint indicated by the field <code>DstHostAddr</code> of <span><a href="#address-header" class="internal xref">the Address Header</a> (<a href="#address-header" class="auto internal xref">Section 2.2.2</a>)</span>.<a href="#section-1.3.2-3.6.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="configuration">
<section id="section-1.3.3">
          <h4 id="name-configuration">
<a href="#section-1.3.3" class="section-number selfRef">1.3.3. </a><a href="#name-configuration" class="section-name selfRef">Configuration</a>
          </h4>
<p id="section-1.3.3-1">Border routers require mappings from SCION  interface IDs to underlay addresses. Such information must be supplied to each router in an out of band fashion (e.g in a configuration file). For each link to a neighbor, these values must be configured. A typical implementation will require:<a href="#section-1.3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3.3-2.1">
              <p id="section-1.3.3-2.1.1">Interface ID.<a href="#section-1.3.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-1.3.3-2.2">
              <p id="section-1.3.3-2.2.1">Link type (core, parent, child, peer). Link type depends on mutual agreements between the organizations operating the ASes at each end of each link.<a href="#section-1.3.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-1.3.3-2.3">
              <p id="section-1.3.3-2.3.1">Neighbor ISD-AS number.<a href="#section-1.3.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-1.3.3-2.4">
              <p id="section-1.3.3-2.4.1">For the router that manages the interface: the neighbor interface underlay address.<a href="#section-1.3.3-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-1.3.3-2.5">
              <p id="section-1.3.3-2.5.1">For the routers that do not manage the interface:  "intra-protocol" address of the router that does.<a href="#section-1.3.3-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-1.3.3-3">In order to forward traffic to a service endpoint addresse (<code>DT/DS</code> == 0b01 in the <span><a href="#common-header" class="internal xref">common header</a> (<a href="#common-header" class="auto internal xref">Section 2.2.1</a>)</span>), a border router translates the service number into a specific destination address. The method used to accomplish the translation is not defined by this document. It only depends on the implementation and the choices of each AS's administrator. In current practice this is accomplished by way of a configuration file.<a href="#section-1.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="construction">
<section id="section-1.4">
        <h3 id="name-path-construction-segment-c">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-path-construction-segment-c" class="section-name selfRef">Path Construction (Segment Combinations)</a>
        </h3>
<p id="section-1.4-1">Paths are discovered by the SCION control plane, which makes them available to SCION endpoints in the form of path segments. As described in <span>[<a href="#I-D.scion-cp" class="cite xref">I-D.scion-cp</a>]</span>, there are three kinds of path segments: up, down, and core. In the data plane, a SCION endpoint creates end-to-end paths from the path segments, by combining multiple path segments. Depending on the network topology, a SCION forwarding path can consist of one, two, or three segments. Each path segment contains several hop fields representing the ASes on the segment as well as one info field with basic information about the segment, such as a timestamp.<a href="#section-1.4-1" class="pilcrow">¶</a></p>
<p id="section-1.4-2">Segments cannot be combined arbitrarily. To construct a valid forwarding path, the source endpoint <span class="bcp14">MUST</span> obey the following rules:<a href="#section-1.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-3.1">
            <p id="section-1.4-3.1.1">There can be at most one of each type of segment (up-, core-, and down-segment). Allowing multiple up- or down-segments would decrease efficiency and the ability of ASes to enforce path policies.<a href="#section-1.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-3.2">
            <p id="section-1.4-3.2.1">If an up-segment is present, it <span class="bcp14">MUST</span> be the first segment in the path.<a href="#section-1.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-3.3">
            <p id="section-1.4-3.3.1">If a down-segment is present, it <span class="bcp14">MUST</span> be the last segment in the path.<a href="#section-1.4-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-3.4">
            <p id="section-1.4-3.4.1">If there are two path segments (one up- and one down-segment) that both announce the same peering link, then a shortcut via this peering link is possible.<a href="#section-1.4-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-3.5">
            <p id="section-1.4-3.5.1">If there are two path segments (one up- and one down-segment) that share a common ancestor AS (in the direction of beaconing), then a shortcut via this common ancestor AS is possible.<a href="#section-1.4-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-3.6">
            <p id="section-1.4-3.6.1">Additionally, all segments without any peering possibility <span class="bcp14">MUST</span> consist of at least two hop fields.<a href="#section-1.4-3.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.4-4"><strong>Note:</strong> The type of segment is known to the endpoint but is not visible in the path header of data packets. Therefore, a SCION router needs to explicitly verify that these rules were followed correctly.<a href="#section-1.4-4" class="pilcrow">¶</a></p>
<p id="section-1.4-5">Besides enabling the enforcement of path policies, the above rules also protect the economic interest of ASes, as they prevent building "valley paths". A valley path contains ASes that do not profit economically from traffic on this route. The name comes from the fact that such paths go "down" (following parent-child links) before going "up" (following child-parent links).<a href="#section-1.4-5" class="pilcrow">¶</a></p>
<p id="section-1.4-6"><a href="#_figure-1" class="auto internal xref">Figure 1</a> below shows the different allowed segment combinations.<a href="#section-1.4-6" class="pilcrow">¶</a></p>
<p id="section-1.4-7"><strong>Note:</strong> It is assumed that the source and destination endpoints are in different ASes (as endpoints from the same AS use an empty forwarding path to communicate with each other).<a href="#section-1.4-7" class="pilcrow">¶</a></p>
<span id="name-illustration-of-possible-pa"></span><div id="_figure-1">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.4-8.1">
<pre>
                                  ------- = end-to-end path
   C = Core AS                    - - - - = unused links
   * = source/destination AS      ------&gt; = direction of beaconing


          Core                        Core                  Core
      ----------&gt;                 ----------&gt;           ----------&gt;
     .-.       .-.               .-.       .-.         .-.       .-.
+-- ( C )-----( C ) --+     +-- ( C )-----(C/*)       (C/*)-----(C/*)
|    `+'       `+'    |     |    `+'       `-'         `-'       `-'
|     |    1a   |     |     |     |     1b                   1c
|     |         |     |     |     |
|     |         |     |     |     |
|    .+.       .+.    |     |    .+.                       Core
|   (   )     (   )   |     |   (   )                 --------------&gt;
|    `+'       `+'    |     |    `+'                        .-.
|     |         |     |     |     |                   +----( C )----+
|     |         |     |     |     |                   |     `-'     |
|     |         |     |     |     |                   |             |
|    .+.       .+.    |     |    .+.                 .+.     1d    .+.
+-&gt; ( * )     ( * ) &lt;-+     +-&gt; ( * )               (C/*)         (C/*)
     `-'       `-'               `-'                 `-'           `-'



          .-.                      .-.                   .-.
+--   +--( C )--+   --+      +--  (C/*)        +--    - ( C ) -    --+
|     |   `-'   |     |      |     `+'         |     |   `-'   |     |
|     |         |     |      |      |          |                     |
|     |    2a   |     |      |  2b  |          |     |    3a   |     |
|     |         |     |      |      |          |                     |
|    .+.       .+.    |      |     .+.         |    .+.       .+.    |
|   (   )     (   )   |      |    (   )        |   (   #-----#   )   |
|    `+'       `+'    |      |     `+'         |    `+'  Peer `+'    |
|     |         |     |      |      |          |     |         |     |
|     |         |     |      |      |          |     |         |     |
|     |         |     |      |      |          |     |         |     |
|    .+.       .+.    |      |     .+.         |    .+.       .+.    |
+-&gt; ( * )     ( * ) &lt;-+      +-&gt;  ( * )        +-&gt; ( * )     ( * ) &lt;-+
     `-'       `-'                 `-'              `-'       `-'


          Core                                    Core
      ----------&gt;                              ----------&gt;
     .-.       .-.             .-.            .-.       .-.        .-.
 +--( C )- - -( C )--+  +---- ( C ) ----+    ( C )- - -( C )  +-- ( C )
 |   `+'       `+'   |  |      `+'      |     `+'       `+'   |    `+'
 |         3b        |  |           4a  |          4b         |  5
 |    |         |    |  |       |       |      |         |    |     |
 |                   |  |               |                     |
 |   .+.       .+.   |  |      .+.      |      + - --. - +    |    .+.
 |  (   #-----#   )  |  |   +-(   )-+   |      +--(   )--+    |   ( * )
 |   `+'  Peer `+'   |  |   |  `-'  |   |      |   `-'   |    |    `+'
 |    |         |    |  |   |       |   |      |         |    |     |
 |    |         |    |  |   |       |   |      |         |    |     |
 |    |         |    |  |   |       |   |      |         |    |     |
 |   .+.       .+.   |  |  .+.     .+.  |     .+.       .+.   |    .+.
 +-&gt;( * )     ( * )&lt;-+  +&gt;( * )   ( * )&lt;+    ( * )     ( * )  +-&gt; ( * )
     `-'       `-'         `-'     `-'        `-'       `-'        `-'
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-illustration-of-possible-pa" class="selfRef">Illustration of possible path-segment combinations. Each node represents a SCION Autonomous System.</a>
          </figcaption></figure>
</div>
<p id="section-1.4-9">The following path-segment combinations are allowed:<a href="#section-1.4-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-10.1">
            <p id="section-1.4-10.1.1"><strong>Communication through core ASes</strong>:<a href="#section-1.4-10.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-10.1.2.1">
                <p id="section-1.4-10.1.2.1.1"><strong>Core-segment combination</strong> (Cases 1a, 1b, 1c, 1d in <a href="#_figure-1" class="auto internal xref">Figure 1</a>): The up- and down-segments of source and destination do not have an AS in common. In this case, a core-segment is required to connect the source's up- and the destination's down-segment (Case 1a). If either the source or the destination AS is a core AS (Case 1b) or both are core ASes (Cases 1c and 1d), then no up- or down-segment(s) are required to connect the respective AS(es) to the core-segment.<a href="#section-1.4-10.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.4-10.1.2.2">
                <p id="section-1.4-10.1.2.2.1"><strong>Immediate combination</strong> (Cases 2a, 2b in <a href="#_figure-1" class="auto internal xref">Figure 1</a>): The last AS on the up-segment (which is necessarily a core AS) is the same as the first AS on the down-segment. In this case, a simple combination of up- and down-segments creates a valid forwarding path. In Case 2b, only one segment is required.<a href="#section-1.4-10.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.4-10.2">
            <p id="section-1.4-10.2.1"><strong>Peering shortcut</strong> (Cases 3a and 3b): A peering link exists between the up- and down-segment. The extraneous path segments to the core are cut off. Note that the up- and down-segments do not need to originate from the same core AS and the peering link could also be traversing to a different ISD.<a href="#section-1.4-10.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-10.3">
            <p id="section-1.4-10.3.1"><strong>AS shortcut</strong> (Cases 4a and 4b): The up- and down-segments intersect at a non-core AS below the ISD core, thus creating a shortcut. In this case, a shorter path is made possible by removing the extraneous part of the path to the core. Note that the up- and down-segments do not need to originate from the same core AS and can even be in different ISDs (if the AS at the intersection is part of multiple ISDs).<a href="#section-1.4-10.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.4-10.4">
            <p id="section-1.4-10.4.1"><strong>On-path</strong> (Case 5): In the case where the source's up-segment contains the destination AS or the destination's down-segment contains the source AS, a single segment is sufficient to construct a forwarding path. Again, no core AS is on the final path.<a href="#section-1.4-10.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="path-authorization">
<section id="section-1.5">
        <h3 id="name-path-authorization">
<a href="#section-1.5" class="section-number selfRef">1.5. </a><a href="#name-path-authorization" class="section-name selfRef">Path Authorization</a>
        </h3>
<p id="section-1.5-1">The SCION data plane provides <em>path authorization</em>. This property ensures that data packets always traverse the network using path segments that were explicitly authorized by the respective ASes, and prevents endpoints from constructing unauthorized paths or paths containing loops. SCION uses symmetric cryptography in the form of Message Authentication Codes (MACs) to authenticate the information encoded in hop fields. Such MACs are verified by routers at forwarding. For a detailed specification, see <a href="#path-auth" class="auto internal xref">Section 4</a>.<a href="#section-1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="header">
<section id="section-2">
      <h2 id="name-scion-header-specification">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-scion-header-specification" class="section-name selfRef">SCION Header Specification</a>
      </h2>
<p id="section-2-1">This section provides a detailed specification of the SCION packet header. SCION also supports extension headers - these are described, too.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="format">
<section id="section-2.1">
        <h3 id="name-scion-packet-header-format">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-scion-packet-header-format" class="section-name selfRef">SCION Packet Header Format</a>
        </h3>
<p id="section-2.1-1">The SCION packet header is composed of a common header, an address header, a path header, and an <span class="bcp14">OPTIONAL</span> extension header, see <a href="#_figure-2" class="auto internal xref">Figure 2</a> below.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<span id="name-high-level-scion-header-str"></span><div id="_figure-2">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-2.1-2.1">
<pre>
+--------------------------------------------------------+
|                     Common header                      |
|                                                        |
+--------------------------------------------------------+
|                     Address header                     |
|                                                        |
+--------------------------------------------------------+
|                      Path header                       |
|                                                        |
+--------------------------------------------------------+
|               Extension header (optional)              |
|                                                        |
+--------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-high-level-scion-header-str" class="selfRef">High-level SCION header structure</a>
          </figcaption></figure>
</div>
<p id="section-2.1-3">The <em>common header</em> contains important meta information like a version number and lengths of the header and payload. In particular, it contains flags that control the format of subsequent headers such as the address and path headers. For more details, see <a href="#common-header" class="auto internal xref">Section 2.2.1</a>.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">The <em>address header</em> contains the ISD-, AS-, and endpoint-addresses of source and destination. The type and length of endpoint addresses are variable and can be set independently using flags in the common header. For more details, see <a href="#address-header" class="auto internal xref">Section 2.2.2</a>.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">The <em>path header</em> contains the full AS-level forwarding path of the packet. A path type field in the common header specifies the path format used in the path header. For more details, see <a href="#path-header" class="auto internal xref">Section 2.2.3</a>.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">Finally, the optional <em>extension</em> header contains a variable number of hop-by-hop and end-to-end options, similar to the extensions in the IPv6 header <span>[<a href="#RFC8200" class="cite xref">RFC8200</a>]</span>. For more details, see <a href="#ext-header" class="auto internal xref">Section 2.3</a>.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<div id="header-alignment">
<section id="section-2.1.1">
          <h4 id="name-header-alignment">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-header-alignment" class="section-name selfRef">Header Alignment</a>
          </h4>
<p id="section-2.1.1-1">The SCION header is aligned to 4 bytes.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="scion-header-structure">
<section id="section-2.2">
        <h3 id="name-scion-header-structure">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-scion-header-structure" class="section-name selfRef">SCION Header Structure</a>
        </h3>
<div id="common-header">
<section id="section-2.2.1">
          <h4 id="name-common-header">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-common-header" class="section-name selfRef">Common Header</a>
          </h4>
<p id="section-2.2.1-1">The SCION common header has the following packet format:<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<span id="name-the-scion-common-header-pac"></span><div id="_figure-3">
<figure id="figure-3">
            <div class="alignLeft art-text artwork" id="section-2.2.1-2.1">
<pre>
0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  TraffCl      |                FlowID                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    NextHdr    |    HdrLen     |          PayloadLen           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    PathType   |DT |DL |ST |SL |              RSV              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-the-scion-common-header-pac" class="selfRef">The SCION common header packet format</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1-3.1">
              <p id="section-2.2.1-3.1.1"><code>Version</code>: The version of the SCION common header. Currently, only version "0" is supported.<a href="#section-2.2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-3.2">
              <p id="section-2.2.1-3.2.1"><code>TrafficClass</code> (<code>TraffCl</code> in the image above): The 8-bit long identifier of the packet's class or priority. The value of the traffic class bits in a received packet or fragment might differ from the value sent by the packet's source. The current use of the <code>TrafficClass</code> field for Differentiated Services and Explicit Congestion Notification is specified in <span>[<a href="#RFC2474" class="cite xref">RFC2474</a>]</span> and <span>[<a href="#RFC3168" class="cite xref">RFC3168</a>]</span>.<a href="#section-2.2.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-3.3">
              <p id="section-2.2.1-3.3.1"><code>FlowID</code>: This 20-bit field labels sequences of packets to be treated in the network as a single flow. Sources <span class="bcp14">MUST</span> set this field.<a href="#section-2.2.1-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-3.4">
              <p id="section-2.2.1-3.4.1"><code>NextHdr</code>: Encodes the type of the first header after the SCION header. This can be either a SCION extension or a layer-4 protocol such as TCP or UDP. Values of this field respect the Assigned SCION Protocol Numbers (see <a href="#protnum" class="auto internal xref">Appendix "Assigned SCION Protocol Numbers"</a>).<a href="#section-2.2.1-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-3.5">
              <p id="section-2.2.1-3.5.1"><code>HdrLen</code>: Specifies the entire length of the SCION header in bytes, i.e., the sum of the lengths of the common header, the address header, and the path header. All SCION header fields are aligned to a multiple of 4 bytes. The SCION header length is computed as <code>HdrLen</code> * 4 bytes. The 8 bits of the <code>HdrLen</code> field limit the SCION header to a maximum of 255 * 4 = 1020 bytes.<a href="#section-2.2.1-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-3.6">
              <p id="section-2.2.1-3.6.1"><code>PayloadLen</code>: Specifies the length of the payload in bytes. The payload includes (SCION) extension headers and the L4 payload. This field is 16 bits long, supporting a maximum payload size of 65'535 bytes.<a href="#section-2.2.1-3.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-3.7">
              <p id="section-2.2.1-3.7.1"><code>PathType</code>: Specifies the type of the SCION path. It is possible to specify up to 256 different types. The format of one path type is independent of all other path types. The currently defined SCION path types are Empty (0), SCION (1), OneHopPath (2), EPIC (3) and COLIBRI (4). This document only specifies the Empty, SCION and OneHopPath path types. The other path types are currently experimental.<a href="#section-2.2.1-3.7.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<span id="name-scion-path-types"></span><div id="_table-1">
<table class="center" id="table-1">
            <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-scion-path-types" class="selfRef">SCION path types</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Value</th>
                <th class="text-left" rowspan="1" colspan="1">Path Type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">Empty path (<code>EmptyPath</code>)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">SCION (<code>SCION</code>)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">One-hop path (<code>OneHopPath</code>)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">EPIC path (experimental)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">COLIBRI path (experimental)</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1-5.1">
              <p id="section-2.2.1-5.1.1"><code>DT/DL/ST/SL</code>: These fields define the endpoint-address type and endpoint-address length for the source and destination endpoint. <code>DT</code> and <code>DL</code> stand for Destination Type and Destination Length, whereas <code>ST</code> and <code>SL</code> stand for Source Type and Source Length. The possible endpoint address length values are 4 bytes, 8 bytes, 12 bytes, and 16 bytes. If some address has a length different from the supported values, the next larger size can be used and the address can be padded with zeros. <a href="#_table-2" class="auto internal xref">Table 2</a> below lists the currently used values for address length. The "type" identifier is only defined in combination with a specific address length. For example, address type "0" is defined as IPv4 in combination with address length 4, but in combination with address length 16, it stands for IPv6. Per address length, several sub-types are possible. <a href="#_table-3" class="auto internal xref">Table 3</a> shows the currently valid allocations of type values to length values.<a href="#section-2.2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<span id="name-address-length-values"></span><div id="_table-2">
<table class="center" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-address-length-values" class="selfRef">Address length values</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">DL/SL Value</th>
                <th class="text-left" rowspan="1" colspan="1">Address Length</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">4 bytes</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">8 bytes</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">12 bytes</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">16 bytes</td>
              </tr>
            </tbody>
          </table>
</div>
<span id="name-allocations-of-type-values-"></span><div id="_table-3">
<table class="center" id="table-3">
            <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-allocations-of-type-values-" class="selfRef">Allocations of type values to length values</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Length (bytes)</th>
                <th class="text-left" rowspan="1" colspan="1">Type</th>
                <th class="text-left" rowspan="1" colspan="1"> Type/Length (binary)</th>
                <th class="text-left" rowspan="1" colspan="1">Interpretation</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">0b0000</td>
                <td class="text-left" rowspan="1" colspan="1">IPv4</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">0b0100</td>
                <td class="text-left" rowspan="1" colspan="1">Service</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">0b1100</td>
                <td class="text-left" rowspan="1" colspan="1">IPv6</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">other</td>
                <td class="text-left" rowspan="1" colspan="1"> </td>
                <td class="text-left" rowspan="1" colspan="1"> </td>
                <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.1-8.1">
              <p id="section-2.2.1-8.1.1"><code>RSV</code>: These bits are currently reserved for future use.<a href="#section-2.2.1-8.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="address-header">
<section id="section-2.2.2">
          <h4 id="name-address-header">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-address-header" class="section-name selfRef">Address Header</a>
          </h4>
<p id="section-2.2.2-1">The SCION address header has the following format:<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<span id="name-the-scion-address-header-pa"></span><div id="_figure-4">
<figure id="figure-4">
            <div class="alignLeft art-text artwork" id="section-2.2.2-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            DstISD             |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                             DstAS                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            SrcISD             |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                             SrcAS                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    DstHostAddr (variable Len)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    SrcHostAddr (variable Len)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-the-scion-address-header-pa" class="selfRef">The SCION address header packet format</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.2-3.1">
              <p id="section-2.2.2-3.1.1"><code>DstISD, SrcISD</code>: The 16-bit ISD identifier of the destination/source.<a href="#section-2.2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-3.2">
              <p id="section-2.2.2-3.2.1"><code>DstAS, SrcAS</code>: The 48-bit AS identifier of the destination/source.<a href="#section-2.2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-3.3">
              <p id="section-2.2.2-3.3.1"><code>DstHostAddr, SrcHostAddr</code>: Specifies the variable length endpoint address of the destination/source. The accepted type and length are defined in the <code>DT/DL/ST/SL</code> fields of the common header.<a href="#section-2.2.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.2-4"><strong>Note:</strong> For more information on addressing in SCION, see the introduction of the SCION Control Plane Specification (<span>[<a href="#I-D.scion-cp" class="cite xref">I-D.scion-cp</a>]</span>).<a href="#section-2.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-header">
<section id="section-2.2.3">
          <h4 id="name-path-header">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-path-header" class="section-name selfRef">Path Header</a>
          </h4>
<p id="section-2.2.3-1">The path header of a SCION packet differs for each SCION path type.<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3-2"><strong>Note:</strong> The path type is set in the <code>PathType</code> field of the SCION common header.<a href="#section-2.2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.2.3-3">Currently, SCION supports three path types:<a href="#section-2.2.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3-4.1">
              <p id="section-2.2.3-4.1.1">The <code>Empty</code> path type (<code>PathType=0</code>). For more information, see <a href="#empty" class="auto internal xref">Section 2.2.3.1</a>.<a href="#section-2.2.3-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.3-4.2">
              <p id="section-2.2.3-4.2.1">The <code>SCION</code> path type (<code>PathType=1</code>). This is the standard path type in SCION. For a detailed description, see <a href="#scion-path-type" class="auto internal xref">Section 2.2.3.2</a>.<a href="#section-2.2.3-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.3-4.3">
              <p id="section-2.2.3-4.3.1">The <code>OneHopPath</code> path type (<code>PathType=2</code>). For more information, see <a href="#onehop" class="auto internal xref">Section 2.2.3.3</a>.<a href="#section-2.2.3-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div id="empty">
<section id="section-2.2.3.1">
            <h5 id="name-empty-path-type">
<a href="#section-2.2.3.1" class="section-number selfRef">2.2.3.1. </a><a href="#name-empty-path-type" class="section-name selfRef">Empty Path Type</a>
            </h5>
<p id="section-2.2.3.1-1">The <code>Empty</code> path type is used to send traffic within an AS. It has no additional fields, i.e., it consumes 0 bytes on the wire.<a href="#section-2.2.3.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3.1-2">One use case of the <code>Empty</code> path type lies in the context of link-failure detection. To this end, SCION uses the Bidirectional Forwarding Detection (BFD) protocol (<span>[<a href="#RFC5880" class="cite xref">RFC5880</a>]</span> and <span>[<a href="#RFC5881" class="cite xref">RFC5881</a>]</span>). BFD is a protocol intended to detect faults in the bidirectional path between two forwarding engines, with typically very low latency. It operates independently of media, data protocols, and routing protocols. SCION uses the <code>Empty</code> path type, together with <code>OneHopPath</code> path type, to bootstrap BFD within SCION. (For more information on the <code>OneHopPath</code> path type, see <a href="#onehop" class="auto internal xref">Section 2.2.3.3</a>.)<a href="#section-2.2.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scion-path-type">
<section id="section-2.2.3.2">
            <h5 id="name-scion-path-type">
<a href="#section-2.2.3.2" class="section-number selfRef">2.2.3.2. </a><a href="#name-scion-path-type" class="section-name selfRef">SCION Path Type</a>
            </h5>
<p id="section-2.2.3.2-1">This section specifies the standard <code>SCION</code> path type.
A SCION path has the following layout:<a href="#section-2.2.3.2-1" class="pilcrow">¶</a></p>
<span id="name-layout-of-a-standard-scion-"></span><div id="_figure-5">
<figure id="figure-5">
              <div class="alignLeft art-text artwork" id="section-2.2.3.2-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          PathMetaHdr                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           InfoField                           |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              ...                              |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           InfoField                           |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           HopField                            |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           HopField                            |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              ...                              |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-layout-of-a-standard-scion-" class="selfRef">Layout of a standard SCION path</a>
              </figcaption></figure>
</div>
<p id="section-2.2.3.2-3">It consists of a path meta header, up to 3 info fields and up to 64 hop fields.<a href="#section-2.2.3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.2-4.1">
                <p id="section-2.2.3.2-4.1.1">The path meta header (<code>PathMetaHdr</code>) indicates the currently valid info field and hop field while the packet is traversing the network along the path, as well as the number of hop fields per segment.<a href="#section-2.2.3.2-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.3.2-4.2">
                <p id="section-2.2.3.2-4.2.1">The number of info fields (<code>InfoField</code>) equals the number of path segments that the path contains - there is one info field per path segment. Each info field contains basic information about the corresponding segment, such as a timestamp indicating the creation time. There are also two flags. One specifies whether the segment is to be traversed in construction direction, the other whether the first or last hop field in the segment represents a peering hop field.<a href="#section-2.2.3.2-4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.3.2-4.3">
                <p id="section-2.2.3.2-4.3.1">Each hop field (<code>HopField</code>) represents a hop through an AS on the path, with the ingress and egress interface identifiers for this AS. This information is authenticated with a Message Authentication Code (MAC) to prevent forgery.<a href="#section-2.2.3.2-4.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.2.3.2-5">The SCION header is created by extracting the required info fields and hop fields from the corresponding path segments. The process of extracting is illustrated in <a href="#_figure-6" class="auto internal xref">Figure 6</a> below. Note that ASes at the joints of multiple segments are represented by two hop fields. Be aware that these hop fields are not equal! In the hop field that represents the last hop in the first segment (seen in the direction of travel), only the ingress interface will be specified. However, in the hop field that represents the first hop in the second segment (also in the direction of travel), only the egress interface will be defined. Thus, the two hop fields for this one AS build a full hop through the AS, specifying both the ingress and egress interface. As such, they bring the two adjacent segments together.<a href="#section-2.2.3.2-5" class="pilcrow">¶</a></p>
<span id="name-path-construction-example"></span><div id="_figure-6">
<figure id="figure-6">
              <div class="alignLeft art-text artwork" id="section-2.2.3.2-6.1">
<pre>
                   +-----------------+
                   |    ISD Core     |
  .--.    .--.     |  .--.     .--.  |     .--.    .--.
 (AS 3)--(AS 4)----|-(AS 1)---(AS 2)-|----(AS 5)--(AS 6)
  `--'    `--'     |  `--'     `--'  |     `--'    `--'
                   +-----------------+

 Up-Segment           Core-Segment        Down-Segment
+---------+           +---------+         +---------+
| +-----+ |           | +-----+ |         | +-----+ |
| + INF + |--------+  | + INF + |---+     | + INF + |--+
| +-----+ |        |  | +-----+ |   |     | +-----+ |  |
| +-----+ |        |  | +-----+ |   |     | +-----+ |  |
| | HF  | |------+ |  | | HF  | |---+-+   | | HF  | |--+-+
| +-----+ |      | |  | +-----+ |   | |   | +-----+ |  | |
| +-----+ |      | |  | +-----+ |   | |   | +-----+ |  | |
| | HF  | |----+ | |  | | HF  | |---+-+-+ | | HF  | |--+-+-+
| +-----+ |    | | |  | +-----+ |   | | | | +-----+ |  | | |
| +-----+ |    | | |  +---------+   | | | | +-----+ |  | | |
| | HF  | |--+ | | |                | | | | | HF  | |--+-+-+-+
| +-----+ |  | | | |  +----------+  | | | | +-----+ |  | | | |
+---------+  | | | |  | ++++++++ |  | | | +---------+  | | | |
             | | | |  | | Meta | |  | | |              | | | |
             | | | |  | ++++++++ |  | | |              | | | |
             | | | |  | +------+ |  | | |              | | | |
             | | | +-&gt;| + INF  + |  | | |              | | | |
             | | |    | +------+ |  | | |              | | | |
             | | |    | +------+ |  | | |              | | | |
             | | |    | + INF  + |&lt;-+ | |              | | | |
             | | |    | +------+ |    | |              | | | |
             | | |    | +------+ |    | |              | | | |
             | | |    | + INF  + |&lt;---+-+--------------+ | | |
             | | |    | +------+ |    | |                | | |
             | | |    | +------+ |    | |                | | |
             | | +---&gt;| |  HF  | |    | |                | | |
             | |      | +------+ |    | |                | | |
             | |      | +------+ |    | |                | | |
             | +-----&gt;| |  HF  | |    | |                | | |
             |        | +------+ |    | |                | | |
             |        | +------+ |    | |                | | |
             +-------&gt;| |  HF  | |    | |                | | |
                      | +------+ |    | |                | | |
                      | +------+ |    | |                | | |
                      | |  HF  | |&lt;---+ |                | | |
                      | +------+ |      |                | | |
                      | +------+ |      |                | | |
     Forwarding Path  | |  HF  | |&lt;-----+                | | |
                      | +------+ |                       | | |
                      | +------+ |                       | | |
                      | |  HF  | |&lt;----------------------+ | |
                      | +------+ |                         | |
                      | +------+ |                         | |
                      | |  HF  | |&lt;------------------------+ |
                      | +------+ |                           |
                      | +------+ |                           |
                      | |  HF  | |&lt;--------------------------+
                      | +------+ |
                      +----------+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-path-construction-example" class="selfRef">Path construction example</a>
              </figcaption></figure>
</div>
<div id="PathMetaHdr">
<section id="section-2.2.3.2.1">
              <h6 id="name-path-meta-header-field">
<a href="#section-2.2.3.2.1" class="section-number selfRef">2.2.3.2.1. </a><a href="#name-path-meta-header-field" class="section-name selfRef">Path Meta Header Field</a>
              </h6>
<p id="section-2.2.3.2.1-1">The 4-byte Path Meta Header field (<code>PathMetaHdr</code>) defines meta information about the SCION path that is contained in the path header. It has the following format:<a href="#section-2.2.3.2.1-1" class="pilcrow">¶</a></p>
<span id="name-scion-path-type-format-of-t"></span><div id="_figure-7">
<figure id="figure-7">
                <div class="alignLeft art-text artwork" id="section-2.2.3.2.1-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| C |  CurrHF   |    RSV    |  Seg0Len  |  Seg1Len  |  Seg2Len  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-scion-path-type-format-of-t" class="selfRef">SCION path type - Format of the Path Meta Header field</a>
                </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.1-3.1">
                  <p id="section-2.2.3.2.1-3.1.1"><code>C</code> (urrINF): Specifies a 2-bits index (0-based) pointing to the current info field for the packet on its way through the network. For details, see <a href="#offset-calc" class="auto internal xref">Section 2.2.3.2.2</a> below.<a href="#section-2.2.3.2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.1-3.2">
                  <p id="section-2.2.3.2.1-3.2.1"><code>CurrHF</code>: Specifies a 6-bits index (0-based) pointing to the current hop field for the packet on its way through the network. For details, see <a href="#offset-calc" class="auto internal xref">Section 2.2.3.2.2</a> below. Note that the <code>CurrHF</code> index <span class="bcp14">MUST</span> point to a hop field that is part of the current path segment, as indicated by the <code>CurrINF</code> index.<a href="#section-2.2.3.2.1-3.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-2.2.3.2.1-4">Both indices are used by SCION routers when forwarding data traffic through the network. The SCION routers also increment the indexes if required. For more details, see <a href="#process-router" class="auto internal xref">Section 4.2.2</a>.<a href="#section-2.2.3.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.1-5.1">
                  <p id="section-2.2.3.2.1-5.1.1"><code>Seg{0,1,2}Len</code>: The number of hop fields in a given segment. Seg{i}Len &gt; 0 implies that segment <em>i</em> contains at least one hop field, which means that info field <em>i</em> exists. (If Seg{i}Len = 0 then segment <em>i</em> is empty, meaning that this path does not include segment <em>i</em>, and therefore there is no info field <em>i</em>.) The following rules apply:<a href="#section-2.2.3.2.1-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.1-5.1.2.1">
                      <p id="section-2.2.3.2.1-5.1.2.1.1">The total number of hop fields in an end-to-end path <span class="bcp14">MUST</span> be equal to the sum of all <code>Seg{0,1,2}Len</code> contained in this end-to-end path.<a href="#section-2.2.3.2.1-5.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-2.2.3.2.1-5.1.2.2">
                      <p id="section-2.2.3.2.1-5.1.2.2.1">It is an error to have Seg{X}Len &gt; 0 AND Seg{Y}Len == 0, where 2 &gt;= <em>X</em> &gt; <em>Y</em> &gt;= 0. That is, if path segment Y is empty, the following path segment X <span class="bcp14">MUST</span> also be empty.<a href="#section-2.2.3.2.1-5.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
                <li class="normal" id="section-2.2.3.2.1-5.2">
                  <p id="section-2.2.3.2.1-5.2.1"><code>RSV</code>: Unused and reserved for future use.<a href="#section-2.2.3.2.1-5.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</section>
</div>
<div id="offset-calc">
<section id="section-2.2.3.2.2">
              <h6 id="name-path-offset-calculations">
<a href="#section-2.2.3.2.2" class="section-number selfRef">2.2.3.2.2. </a><a href="#name-path-offset-calculations" class="section-name selfRef">Path Offset Calculations</a>
              </h6>
<p id="section-2.2.3.2.2-1">The path offset calculations are used by the SCION border routers to determine the info field and hop field that are currently valid for the packet on its way through the network.<a href="#section-2.2.3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3.2.2-2">The following rules apply when calculating the path offsets:<a href="#section-2.2.3.2.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.3.2.2-3">
<pre>
   if Seg2Len &gt; 0: NumINF = 3
   else if Seg1Len &gt; 0: NumINF = 2
   else if Seg0Len &gt; 0: NumINF = 1
   else: invalid
</pre><a href="#section-2.2.3.2.2-3" class="pilcrow">¶</a>
</div>
<p id="section-2.2.3.2.2-4">The offsets of the current info field and current hop field (relative to the end of the address header) are now calculated as:<a href="#section-2.2.3.2.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2.3.2.2-5">
<pre>
   B = byte
   InfoFieldOffset = 4B + 8B.CurrINF
   HopFieldOffset = 4B + 8B.NumINF + 12B.CurrHF
</pre><a href="#section-2.2.3.2.2-5" class="pilcrow">¶</a>
</div>
<p id="section-2.2.3.2.2-6">To check that the current hop field is in the segment of the current info field, the <code>CurrHF</code> needs to be compared to the <code>SegLen</code> fields of the current and preceding info fields.<a href="#section-2.2.3.2.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="inffield">
<section id="section-2.2.3.2.3">
              <h6 id="name-info-field">
<a href="#section-2.2.3.2.3" class="section-number selfRef">2.2.3.2.3. </a><a href="#name-info-field" class="section-name selfRef">Info Field</a>
              </h6>
<p id="section-2.2.3.2.3-1">The 8-byte Info Field (<code>InfoField</code>) has the following format:<a href="#section-2.2.3.2.3-1" class="pilcrow">¶</a></p>
<span id="name-scion-path-type-format-of-th"></span><div id="_figure-8">
<figure id="figure-8">
                <div class="alignLeft art-text artwork" id="section-2.2.3.2.3-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|r r r r r r P C|      RSV      |             Acc               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Timestamp                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-scion-path-type-format-of-th" class="selfRef">SCION path type - Format of the Info Field</a>
                </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.3-3.1">
                  <p id="section-2.2.3.2.3-3.1.1"><code>r</code>: The <code>r</code> bits are unused and reserved for future use.<a href="#section-2.2.3.2.3-3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.3-3.2">
                  <p id="section-2.2.3.2.3-3.2.1"><code>P</code>: Peering flag. If the flag has value "1", the segment represented by this info field contains a peering hop field, which requires special processing in the data plane. For more details, see <a href="#peerlink" class="auto internal xref">Section 4.1.2</a> and <a href="#packet-verif" class="auto internal xref">Section 4.2</a>.<a href="#section-2.2.3.2.3-3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.3-3.3">
                  <p id="section-2.2.3.2.3-3.3.1"><code>C</code>: Construction direction flag. If the flag has value "1", the hop fields in the segment represented by this info field are arranged in the direction they have been constructed during beaconing.<a href="#section-2.2.3.2.3-3.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.3-3.4">
                  <p id="section-2.2.3.2.3-3.4.1"><code>RSV</code>: Unused and reserved for future use.<a href="#section-2.2.3.2.3-3.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.3-3.5">
                  <p id="section-2.2.3.2.3-3.5.1"><code>Acc</code>: This updatable field/counter is required for calculating the MAC in the data plane. <code>Acc</code> stands for "Accumulator". For more details, see <a href="#auth-chained-macs" class="auto internal xref">Section 4.1</a>.<a href="#section-2.2.3.2.3-3.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.3-3.6">
                  <p id="section-2.2.3.2.3-3.6.1"><code>Timestamp</code>: Timestamp created by the initiator of the corresponding beacon. The timestamp is defined as the number of seconds elapsed since the POSIX Epoch (1970-01-01 00:00:00 UTC), encoded as a 32-bit unsigned integer. This timestamp enables the validation of a hop field in the segment represented by this info field, by verifying the expiration time and MAC set in the hop field - the expiration time of a hop field is calculated relative to the timestamp.<a href="#section-2.2.3.2.3-3.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</section>
</div>
<div id="hopfld">
<section id="section-2.2.3.2.4">
              <h6 id="name-hop-field">
<a href="#section-2.2.3.2.4" class="section-number selfRef">2.2.3.2.4. </a><a href="#name-hop-field" class="section-name selfRef">Hop Field</a>
              </h6>
<p id="section-2.2.3.2.4-1">The 12-byte Hop Field (<code>HopField</code>) has the following format:<a href="#section-2.2.3.2.4-1" class="pilcrow">¶</a></p>
<span id="name-scion-path-type-format-of-the"></span><div id="_figure-9">
<figure id="figure-9">
                <div class="alignLeft art-text artwork" id="section-2.2.3.2.4-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|r r r r r r I E|    ExpTime    |           ConsIngress         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        ConsEgress             |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                              MAC                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-scion-path-type-format-of-the" class="selfRef">SCION path type - Format of the Hop Field</a>
                </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.4-3.1">
                  <p id="section-2.2.3.2.4-3.1.1"><code>r</code>: The <code>r</code> bits are unused and reserved for future use.<a href="#section-2.2.3.2.4-3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.4-3.2">
                  <p id="section-2.2.3.2.4-3.2.1"><code>I</code>: The ConsIngress Router Alert flag. If the ConsIngress Router Alert flag has value "1", the ingress router (in construction direction) will process the L4 payload in the packet. The construction direction is the direction of beaconing.<a href="#section-2.2.3.2.4-3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.4-3.3">
                  <p id="section-2.2.3.2.4-3.3.1"><code>E</code>: The ConsEgress Router Alert flag. If the ConsEgress Router Alert flag has value "1", the egress router (in construction direction) will process the L4 payload in the packet.<a href="#section-2.2.3.2.4-3.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-2.2.3.2.4-4"><strong>Note:</strong> A sender cannot rely on multiple routers retrieving and processing the payload even if it sets multiple router alert flags. This is use-case dependent: In the case of Traceroute informational messages, for example, the router for which the traceroute request is intended will process the request (if the corresponding Router Alert flag is set to "1") and reply to it without further forwarding the request along the path. Use cases that require multiple routers/hops on the path to process a packet have to instead rely on a hop-by-hop extension (see <a href="#ext-header" class="auto internal xref">Section 2.3</a>). For general information on router alerts, see <span>[<a href="#RFC2711" class="cite xref">RFC2711</a>]</span>.<a href="#section-2.2.3.2.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.4-5.1">
                  <p id="section-2.2.3.2.4-5.1.1"><code>ExpTime</code>: Expiry time of a hop field. The field is 1-byte long, thus there are 256 different values available to express an expiration time. The expiration time specified in this field is relative. An absolute expiration time in seconds is computed in combination with the <code>Timestamp</code> field (from the corresponding info field), as follows:<a href="#section-2.2.3.2.4-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.2.4-5.1.2.1">
                      <p id="section-2.2.3.2.4-5.1.2.1.1"><code>Timestamp</code> + (1 + <code>ExpTime</code>) * (24 hours/256)<a href="#section-2.2.3.2.4-5.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
                <li class="normal" id="section-2.2.3.2.4-5.2">
                  <p id="section-2.2.3.2.4-5.2.1"><code>ConsIngress</code>, <code>ConsEgress</code>: The 16-bits ingress/egress interface IDs in construction direction, that is, the direction of beaconing.<a href="#section-2.2.3.2.4-5.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.2.3.2.4-5.3">
                  <p id="section-2.2.3.2.4-5.3.1"><code>MAC</code>: The 6-byte Message Authentication Code to authenticate the hop field. For details on how this MAC is calculated, see <a href="#hf-mac-calc" class="auto internal xref">Section 4.1.1</a>.<a href="#section-2.2.3.2.4-5.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</section>
</div>
</section>
</div>
<div id="onehop">
<section id="section-2.2.3.3">
            <h5 id="name-one-hop-path-type">
<a href="#section-2.2.3.3" class="section-number selfRef">2.2.3.3. </a><a href="#name-one-hop-path-type" class="section-name selfRef">One-Hop Path Type</a>
            </h5>
<p id="section-2.2.3.3-1">The one-hop path type <code>OneHopPath</code> is currently used to bootstrap beaconing between neighboring ASes. This is necessary, as neighbor ASes do not have a forwarding path yet before beaconing is started.<a href="#section-2.2.3.3-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3.3-2">A one-hop path has exactly one info field and two hop fields with the specialty that the second hop field is not known a priori, but is instead created by the ingress SCION border router of the neighboring AS while processing the one-hop path. Any entity with access to the forwarding key of the source endpoint AS can create a valid info and hop field as described in <a href="#inffield" class="auto internal xref">Section 2.2.3.2.3</a> and <a href="#hopfld" class="auto internal xref">Section 2.2.3.2.4</a>, respectively.<a href="#section-2.2.3.3-2" class="pilcrow">¶</a></p>
<p id="section-2.2.3.3-3">Upon receiving a packet containing a one-hop path, the ingress border router of the destination AS fills in the <code>ConsIngress</code> field in the second hop field of the one-hop path with the ingress interface ID. It sets the <code>ConsEgress</code> field to an invalid value (e.g. unspecified value 0), ensuring the path cannot be used beyond the destination AS. Then it calculates and appends the appropriate MAC for the hop field.<a href="#section-2.2.3.3-3" class="pilcrow">¶</a></p>
<p id="section-2.2.3.3-4"><a href="#_figure-10" class="auto internal xref">Figure 10</a> below shows the layout of a SCION one-hop path type. There is only a single info field; the appropriate hop field can be processed by a border router based on the source and destination address. In this context, the following rules apply:<a href="#section-2.2.3.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.3-5.1">
                <p id="section-2.2.3.3-5.1.1">At the source endpoint AS, <em>CurrHF := 0</em>.<a href="#section-2.2.3.3-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.3.3-5.2">
                <p id="section-2.2.3.3-5.2.1">At the destination endpoint AS, <em>CurrHF := 1</em>.<a href="#section-2.2.3.3-5.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<span id="name-layout-of-the-scion-one-hop"></span><div id="_figure-10">
<figure id="figure-10">
              <div class="alignLeft art-text artwork" id="section-2.2.3.3-6.1">
<pre>
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           InfoField                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           HopField                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           HopField                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-layout-of-the-scion-one-hop" class="selfRef">Layout of the SCION one-hop path type</a>
              </figcaption></figure>
</div>
</section>
</div>
<div id="reverse">
<section id="section-2.2.3.4">
            <h5 id="name-path-reversal">
<a href="#section-2.2.3.4" class="section-number selfRef">2.2.3.4. </a><a href="#name-path-reversal" class="section-name selfRef">Path Reversal</a>
            </h5>
<p id="section-2.2.3.4-1">When a destination endpoint receives a SCION packet, it can use the path information in the SCION header for sending the reply packets. For this, the destination endpoint <span class="bcp14">MUST</span> perform the following steps:<a href="#section-2.2.3.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.3.4-2">
<li id="section-2.2.3.4-2.1">
                <p id="section-2.2.3.4-2.1.1">Reverse the order of the info fields;<a href="#section-2.2.3.4-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.2.3.4-2.2">
                <p id="section-2.2.3.4-2.2.1">Reverse the order of the hop fields;<a href="#section-2.2.3.4-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.2.3.4-2.3">
                <p id="section-2.2.3.4-2.3.1">For each info field, negate the construction direction flag <code>C</code>; do not change the accumulator field <code>Acc</code>.<a href="#section-2.2.3.4-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-2.2.3.4-2.4">
                <p id="section-2.2.3.4-2.4.1">In the <code>PathMetaHdr</code> field:<a href="#section-2.2.3.4-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.3.4-2.4.2.1">
                    <p id="section-2.2.3.4-2.4.2.1.1">Set the <code>CurrINF</code> and <code>CurrHF</code> to "0".<a href="#section-2.2.3.4-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.2.3.4-2.4.2.2">
                    <p id="section-2.2.3.4-2.4.2.2.1">Reverse the order of the non-zero <code>SegLen</code> fields.<a href="#section-2.2.3.4-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
<p id="section-2.2.3.4-2.4.3">
<strong>Note:</strong> For more information on the <code>PathMetaHdr</code> field, see <a href="#PathMetaHdr" class="auto internal xref">Section 2.2.3.2.1</a>.<a href="#section-2.2.3.4-2.4.3" class="pilcrow">¶</a></p>
</li>
            </ol>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="ext-header">
<section id="section-2.3">
        <h3 id="name-extension-headers">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-extension-headers" class="section-name selfRef">Extension Headers</a>
        </h3>
<p id="section-2.3-1">This section specifies the SCION extension headers. SCION currently provides two types of extension headers: the Hop-by-Hop (HBH) Options header and the End-to-End (E2E) Options header.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-2.1">
            <p id="section-2.3-2.1.1">The Hop-by-Hop Options header is used to carry optional information that may be examined and processed by every SCION router along a packet's delivery path. The Hop-by-Hop Options header is identified by value "200" in the <code>NextHdr</code> field of the SCION common header (see <a href="#common-header" class="auto internal xref">Section 2.2.1</a>).<a href="#section-2.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.3-2.2">
            <p id="section-2.3-2.2.1">The End-to-End Options header is used to carry optional information that may be examined and processed by the sender and/or the receiver of the packet. The End-to-End Options header is identified by value "201" in the <code>NextHdr</code> field of the SCION common header (see <a href="#common-header" class="auto internal xref">Section 2.2.1</a>).<a href="#section-2.3-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.3-3">If both headers are present, the HBH Options header <span class="bcp14">MUST</span> come before the E2E Options header.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4"><strong>Note:</strong> The SCION extension headers are defined and used based on and similar to the IPv6 extensions as specified in section 4 of <span>[<a href="#RFC8200" class="cite xref">RFC8200</a>]</span>. The SCION Hop-by-Hop Options header and End-to-End Options header resemble the IPv6 Hop-by-Hop Options Header (section 4.3 in the RFC) and Destination Options Header (section 4.6), respectively.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<div id="oh-format">
<section id="section-2.3.1">
          <h4 id="name-format-of-the-scion-options">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-format-of-the-scion-options" class="section-name selfRef">Format of the SCION Options Headers</a>
          </h4>
<p id="section-2.3.1-1">The SCION Hop-by-Hop Options and End-to-End Options headers have the following format:<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<span id="name-extension-headers-options-h"></span><div id="_figure-11">
<figure id="figure-11">
            <div class="alignLeft art-text artwork" id="section-2.3.1-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    NextHdr    |     ExtLen    |            Options            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-extension-headers-options-h" class="selfRef">Extension headers: Options header</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.3.1-3.1">
              <p id="section-2.3.1-3.1.1"><code>NextHdr</code>: Unsigned 8-bit integer. Identifies the type of header immediately following the Hop-by-Hop/End-to-End Options header. Values of this field respect the Assigned SCION Protocol Numbers (see also <a href="#protnum" class="auto internal xref">Appendix "Assigned SCION Protocol Numbers"</a>).<a href="#section-2.3.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.1-3.2">
              <p id="section-2.3.1-3.2.1"><code>ExtLen</code>: 8-bit unsigned integer. The length of the Hop-by-hop or End-to-end options header in 4-octet units, not including the first 4 octets. That is: <code>ExtLen = uint8(((L + 2) / 4) - 1)</code>, where <code>L</code> is the size of the header in bytes, assuming that <code>L + 2</code> is a multiple of 4.<a href="#section-2.3.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.1-3.3">
              <p id="section-2.3.1-3.3.1"><code>Options</code>: This is a variable-length field. The length of this field <span class="bcp14">MUST</span> be such that the complete length of the Hop-by-Hop/End-to-End Options header is an integer multiple of 4 bytes. This can be achieved by using options of type 0 or 1 (see <a href="#_table-4" class="auto internal xref">Table 4</a>) . The <code>Options</code> field contains one or more Type-Length-Value (TLV) encoded options. For details, see <a href="#optfld" class="auto internal xref">Section 2.3.1.1</a>.<a href="#section-2.3.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.3.1-4">The Hop-by-Hop/End-to-End Options header is aligned to 4 bytes.<a href="#section-2.3.1-4" class="pilcrow">¶</a></p>
<div id="optfld">
<section id="section-2.3.1.1">
            <h5 id="name-options-field">
<a href="#section-2.3.1.1" class="section-number selfRef">2.3.1.1. </a><a href="#name-options-field" class="section-name selfRef">Options Field</a>
            </h5>
<p id="section-2.3.1.1-1">The <code>Options</code> field of the Hop-by-Hop Options and the End-to-End Options headers carries a variable number of options that are type-length-value (TLV) encoded. Each TLV-encoded option has the following format:<a href="#section-2.3.1.1-1" class="pilcrow">¶</a></p>
<span id="name-options-field-tlv-encoded-o"></span><div id="_figure-12">
<figure id="figure-12">
              <div class="alignLeft art-text artwork" id="section-2.3.1.1-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    OptType    |  OptDataLen   |            OptData            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                              ...                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-options-field-tlv-encoded-o" class="selfRef">Options field: TLV-encoded options</a>
              </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.3.1.1-3.1">
                <p id="section-2.3.1.1-3.1.1"><code>OptType</code>: 8-bit identifier of the type of option. The following option types are assigned to the SCION HBH/E2E Options header:<a href="#section-2.3.1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<span id="name-option-types-of-scion-optio"></span><div id="_table-4">
<table class="center" id="table-4">
              <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-option-types-of-scion-optio" class="selfRef">Option types of SCION Options header</a>
              </caption>
<thead>
                <tr>
                  <th class="text-left" rowspan="1" colspan="1">Decimal</th>
                  <th class="text-left" rowspan="1" colspan="1">Option Type</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">0</td>
                  <td class="text-left" rowspan="1" colspan="1">Pad1 (see <a href="#pad1" class="auto internal xref">Section 2.3.1.1.1</a>)</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">1</td>
                  <td class="text-left" rowspan="1" colspan="1">PadN (see <a href="#padn" class="auto internal xref">Section 2.3.1.1.2</a>)</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">2</td>
                  <td class="text-left" rowspan="1" colspan="1">SCION Packet Authenticator Option.<br> Only used by the End-to-End Options header (experimental).</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">253</td>
                  <td class="text-left" rowspan="1" colspan="1">Used for experimentation and testing</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">254</td>
                  <td class="text-left" rowspan="1" colspan="1">Used for experimentation and testing</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">255</td>
                  <td class="text-left" rowspan="1" colspan="1">Reserved</td>
                </tr>
              </tbody>
            </table>
</div>
<ul class="normal">
<li class="normal" id="section-2.3.1.1-5.1">
                <p id="section-2.3.1.1-5.1.1"><code>OptDataLen</code>: Unsigned 8-bit integer denoting the length of the <code>OptData</code> field of this option in bytes.<a href="#section-2.3.1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.1.1-5.2">
                <p id="section-2.3.1.1-5.2.1"><code>OptData</code>: Variable-length field. Option-type specific data.<a href="#section-2.3.1.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.3.1.1-6">The options within a header <span class="bcp14">MUST</span> be processed strictly in the order they appear in the header. This is to prevent a receiver from, for example, scanning through the header looking for a specific option and processing this option prior to all preceding ones.<a href="#section-2.3.1.1-6" class="pilcrow">¶</a></p>
<p id="section-2.3.1.1-7">Individual options may have specific alignment requirements, to ensure that multibyte values within the <code>OptData</code> fields have natural boundaries. The alignment requirement of an option is specified using the notation "xn+y". This means that the <code>OptType</code> <span class="bcp14">MUST</span> appear at an integer multiple of x bytes from the start of the header, plus y bytes. For example:<a href="#section-2.3.1.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1.1-8.1">
                <p id="section-2.3.1.1-8.1.1"><code>2n</code>: means any 2-bytes offset from the start of the header.<a href="#section-2.3.1.1-8.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.3.1.1-8.2">
                <p id="section-2.3.1.1-8.2.1"><code>4n+2</code>: means any 4-bytes offset from the start of the header, plus 2 bytes.<a href="#section-2.3.1.1-8.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.3.1.1-9">There are two padding options to align subsequent options and to pad out the containing header to a multiple of 4 bytes in length - for details, see below. All SCION implementations <span class="bcp14">MUST</span> recognize these padding options.<a href="#section-2.3.1.1-9" class="pilcrow">¶</a></p>
<div id="pad1">
<section id="section-2.3.1.1.1">
              <h6 id="name-pad1-option">
<a href="#section-2.3.1.1.1" class="section-number selfRef">2.3.1.1.1. </a><a href="#name-pad1-option" class="section-name selfRef">Pad1 Option</a>
              </h6>
<p id="section-2.3.1.1.1-1">Alignment requirement: none.<a href="#section-2.3.1.1.1-1" class="pilcrow">¶</a></p>
<span id="name-tlv-encoded-options-pad1-op"></span><div id="_figure-13">
<figure id="figure-13">
                <div class="alignLeft art-text artwork" id="section-2.3.1.1.1-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+
|       0       |
+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-tlv-encoded-options-pad1-op" class="selfRef">TLV-encoded options - Pad1 option</a>
                </figcaption></figure>
</div>
<p id="section-2.3.1.1.1-3"><strong>Note:</strong> The format of the Pad1 option is a special case - it does not have length and value fields.<a href="#section-2.3.1.1.1-3" class="pilcrow">¶</a></p>
<p id="section-2.3.1.1.1-4">The Pad1 option is used to insert 1 byte of padding into the <code>Options</code> field of an extension header. If more than one byte of padding is required, the PadN option <span class="bcp14">SHOULD</span> be used, rather than multiple Pad1 options. See the next section for more information on the PadN option.<a href="#section-2.3.1.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="padn">
<section id="section-2.3.1.1.2">
              <h6 id="name-padn-option">
<a href="#section-2.3.1.1.2" class="section-number selfRef">2.3.1.1.2. </a><a href="#name-padn-option" class="section-name selfRef">PadN Option</a>
              </h6>
<p id="section-2.3.1.1.2-1">Alignment requirement: none.<a href="#section-2.3.1.1.2-1" class="pilcrow">¶</a></p>
<span id="name-tlv-encoded-options-padn-op"></span><div id="_figure-14">
<figure id="figure-14">
                <div class="alignLeft art-text artwork" id="section-2.3.1.1.2-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       1       |  OptDataLen   |            OptData            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                              ...                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-tlv-encoded-options-padn-op" class="selfRef">TLV-encoded options - PadN option</a>
                </figcaption></figure>
</div>
<p id="section-2.3.1.1.2-3">The PadN option is used to insert two or more bytes of padding into the <code>Options</code> field of an extension header. For N bytes of padding, the <code>OptDataLen</code> field contains the value N-2, and the <code>OptData</code> consists of N-2 zero-valued bytes.<a href="#section-2.3.1.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="upper-layer-protocol-issues">
<section id="section-2.4">
        <h3 id="name-upper-layer-protocol-issues">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-upper-layer-protocol-issues" class="section-name selfRef">Upper-Layer Protocol Issues</a>
        </h3>
<div id="pseudo">
<section id="section-2.4.1">
          <h4 id="name-pseudo-header-for-upper-lay">
<a href="#section-2.4.1" class="section-number selfRef">2.4.1. </a><a href="#name-pseudo-header-for-upper-lay" class="section-name selfRef">Pseudo Header for Upper-Layer Checksum</a>
          </h4>
<p id="section-2.4.1-1">Any transport or other upper-layer protocol that includes addresses from the SCION header in the checksum computation <span class="bcp14">MUST</span> use the following pseudo header:<a href="#section-2.4.1-1" class="pilcrow">¶</a></p>
<span id="name-layout-of-the-pseudo-header"></span><div id="_figure-15">
<figure id="figure-15">
            <div class="alignLeft art-text artwork" id="section-2.4.1-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -----+
|            DstISD             |                               |      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               + SCION|
|                             DstAS                             |   ad-|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ dress|
|            SrcISD             |                               |  hea-|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +   der|
|                             SrcAS                             |      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+      |
|                    DstHostAddr (variable Len)                 |      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+      |
|                    SrcHostAddr (variable Len)                 |      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -----+
|                    Upper-Layer Packet Length                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      zero                     |  Next Header  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a>:
<a href="#name-layout-of-the-pseudo-header" class="selfRef">Layout of the pseudo header for the upper-layer checksum</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-2.4.1-3.1">
              <p id="section-2.4.1-3.1.1"><code>DstISD</code>, <code>SrcISD</code>, <code>DstAS</code>, <code>SrcAS</code>, <code>DstHostAddr</code>, <code>SrcHostAddr</code>: These values are taken from the SCION address header.<a href="#section-2.4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.4.1-3.2">
              <p id="section-2.4.1-3.2.1"><code>Upper-Layer Packet Length</code>: The length of the upper-layer header and data. Some upper-layer protocols define headers that carry the length information explicitly (e.g., UDP). This information is used as the upper-layer packet length in the pseudo header for these protocols. The remaining protocols, which do not carry the length information directly, use the value from the <code>PayloadLen</code> field in the SCION common header, minus the sum of the extension header lengths.<a href="#section-2.4.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.4.1-3.3">
              <p id="section-2.4.1-3.3.1"><code>Next Header</code>: The protocol identifier associated with the upper-layer protocol (e.g., 17 for UDP - see also <a href="#protnum" class="auto internal xref">Appendix "Assigned SCION Protocol Numbers"</a>). This field can differ from the <code>NextHdr</code> field in the SCION common header, if extensions are present.<a href="#section-2.4.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="life-of-a-scion-data-packet">
<section id="section-3">
      <h2 id="name-life-of-a-scion-data-packet">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-life-of-a-scion-data-packet" class="section-name selfRef">Life of a SCION Data Packet</a>
      </h2>
<p id="section-3-1">This section gives a high-level description of the life cycle of a SCION packet: How it is crafted at its source endpoint, passes through a number of routers, and finally reaches its destination endpoint. It is assumed that both source and destination are native SCION endpoints (i.e., they both run a native SCION network stack).<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">To keep it brief, the example illustrates an intra-ISD case, i.e., all communication happens within a single ISD. As the sample ISD only consists of one core AS, the end-to-end path only includes an up-path and down-path segment. In the case of inter-ISD forwarding, the complete end-to-end path from source endpoint to destination endpoint would always require a core-path segment, too. But this makes no difference for the forwarding process, which works the same in an intra- and inter-ISD context. We therefore abstain from describing the inter-ISD forwarding.<a href="#section-3-2" class="pilcrow">¶</a></p>
<div id="description">
<section id="section-3.1">
        <h3 id="name-description">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-description" class="section-name selfRef">Description</a>
        </h3>
<span id="name-sample-topology-to-illustra"></span><div id="_figure-16">
<figure id="figure-16">
          <div class="alignLeft art-text artwork" id="section-3.1-1.1">
<pre>
                    +--------------------+
                    |                    |
                    |        AS 1        |
                    |                    |
                    |                    |
                    |     198.51.100.4 .-+. i1b (1-1,198.51.100.17)
                    |          +------( R3 )---+
                   .+-.        |       `-+'    |
          +-------( R2 )-------+         |     |
          |    i1a `+-' 198.51.100.1     |     |
          |         |                    |     |
          |         +--------------------+     | (1-3,198.51.100.18)
          |                                    | i3a
          |                                   .+-.
    i2a .-+.                          +------( R4 )--------+
+------( R1 )--------+                |       `-+'         |
|       `-+'         |                |         |192.0.2.34|
|         |203.0.113.17               |         |          |
|         |          |                |         |    AS 3  |
|         |    AS 2  |                |         |          |
|         |          |                |       +---+        |
|       +---+        |                |       | B |        |
|       | A |        |                |       +---+        |
|       +---+        |                |   1-3,192.0.2.7    |
|  1-2,203.0.113.6   |                |                    |
|                    |                +--------------------+
+--------------------+
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a>:
<a href="#name-sample-topology-to-illustra" class="selfRef">Sample topology to illustrate the life cycle of a SCION packet. AS 1 is the core AS of ISD 1, and AS 2 and AS 3 are non-core ASes of ISD 1.</a>
          </figcaption></figure>
</div>
<p id="section-3.1-2">Based on the network topology in <a href="#_figure-16" class="auto internal xref">Figure 16</a> above, this example shows the path of a SCION packet sent from source endpoint A to destination endpoint B, and how it will be processed by each router on the path. This is done by means of simplified snapshots of the packet header after each such processing step. These snapshots, which are depicted in tables, show the most relevant information of the header, i.e., the SCION path and IP encapsulation for local communication.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="creating-an-end-to-end-scion-forwarding-path">
<section id="section-3.2">
        <h3 id="name-creating-an-end-to-end-scio">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-creating-an-end-to-end-scio" class="section-name selfRef">Creating an End-to-End SCION Forwarding Path</a>
        </h3>
<p id="section-3.2-1">In this example, source endpoint A in AS 2 wants to send a data packet to destination endpoint B in AS 3. Both AS 2 and AS 3 are part of ISD 1. To create an end-to-end SCION forwarding path, source endpoint A first requests its own AS-2 control service for up-segments to the core AS in its ISD. The AS-2 control service will return up-segments from AS 2 to the ISD core. Endpoint A will also query its AS-2 control service for a down-segment from its ISD core AS to AS 3, in which destination endpoint B is located. The AS-2 control service (possibly after connecting to the core control service) will return down-segments from the ISD core down to AS 3.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2"><strong>Note:</strong> For more details on the lookup of path segments, see the section "Path Lookup" in the Control Plane specification (<span>[<a href="#I-D.scion-cp" class="cite xref">I-D.scion-cp</a>]</span>).<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">Based on its own selection criteria, source endpoint A selects the up-segment (0,i2a)(i1a,0) and the down-segment (0,i1b)(i3a,0) from the path segments returned by its own AS-2 control service. The path segments consist of hop fields that carry the ingress and egress interfaces of each AS (e.g., i2a, i1a, ...), as described in detail in <a href="#format" class="auto internal xref">Section 2.1</a> - (x,y) represents one hop field.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">To obtain an end-to-end forwarding path from the source AS to the destination AS, source endpoint A combines the two path segments into the resulting SCION forwarding path, which contains the two info fields <em>IF1</em> and <em>IF2</em> and the hop fields (0,i2a), (i1a,0), (0,i1b), and (i3a,0).<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5"><strong>Note:</strong> As this brief sample path does not contain a core-segment, the end-to-end path only consists of two path segments.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">Source endpoint A now adds this end-to-end forwarding path to the header of the packet that A wants to send to destination endpoint B, and starts transferring the packet. The following section describes what happens with the SCION packet header on the packet's way from A to B.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="step-by-step-explanation">
<section id="section-3.3">
        <h3 id="name-step-by-step-explanation">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-step-by-step-explanation" class="section-name selfRef">Step-by-Step Explanation</a>
        </h3>
<p id="section-3.3-1">This section explains the packet header modifications at each router, based on the network topology in <a href="#_figure-16" class="auto internal xref">Figure 16</a> above. Each step includes a table that represents a simplified snapshot of the packet header at the end of this specific step. Regarding the notation used in the figure/tables, each SRC and DST entry should be read as router (or endpoint) followed by its address. The current info field (with metadata on the current path segment) in the SCION header is depicted italic/cursive in the tables. The current hop field, representing the current AS, is shown bold. The snapshot tables also include references to IP/UDP addresses.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2"><strong>Note:</strong> In this context, a border router is called <strong>ingress</strong> border router when it refers to an entrance border router to an AS, as seen from the direction of travel of the SCION packet. So in the context here, the ingress border router is the <em>(packet) incoming</em> border router. A border router is called <strong>egress</strong> border router when it refers to an exit border router of an AS, as seen from the direction of travel of the SCION packet. So in this context, the egress border router is the <em>(packet) leaving</em> border router.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-3.1">
            <p id="section-3.3-3.1.1"><em>Step 1</em> <br> <strong>A-&gt;R1</strong>: The SCION-enabled source endpoint A in AS 2 creates a new SCION packet destined for destination endpoint B in AS 3, with payload P. Endpoint A sends the packet (for the chosen forwarding path) to the next SCION router as provided by its control service, which is in this case R1. A encapsulates the SCION packet into an underlay UDP/IPv4 header for the local delivery to R1, utilizing AS 2's internal routing protocol. The current info field is <em>IF1</em>. Upon receiving the packet, R1 will forward the packet on the egress interface that endpoint A has included into the first hop field of the SCION header.<a href="#section-3.3-3.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-snapshot-header-step-1"></span><table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-snapshot-header-step-1" class="selfRef">Snapshot header - step 1</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">A -&gt; R1</th>
              <th class="text-left" rowspan="1" colspan="1"> </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">SCION</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 1-2,203.0.113.6 (source endpoint A) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 1-3,192.0.2.7 (dest. endpoint B) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">PATH = <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- <em>IF1</em> <strong>(0,i2a)</strong> (i1a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- IF2 (0,i1b) (i3a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">UDP</td>
              <td class="text-left" rowspan="1" colspan="1">P<sub>S</sub> = 30041, P<sub>D</sub> = 30041 <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">IP</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 203.0.113.6 (endpoint A) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 203.0.113.17 (router R1) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Link layer</td>
              <td class="text-left" rowspan="1" colspan="1">SRC=A, DST=R1</td>
            </tr>
          </tbody>
        </table>
<ul class="normal">
<li class="normal" id="section-3.3-5.1">
            <p id="section-3.3-5.1.1"><em>Step 2</em> <br> <strong>R1-&gt;R2</strong>: Router R1 inspects the SCION header and considers the relevant info field of the specified SCION path, which is the info field indicated by the current info field pointer. In this case, it is the first info field <em>IF1</em>. The current hop field is the first hop field (0,i2a), which instructs router R1 to forward the packet on its interface i2a. After reading the current hop field, R1 moves the pointer forward by one position to the second hop field (i1a,0). Note that, at this point, no underlay IP header is necessary, since the routers R1 and R2 are directly connected over layer 2.<a href="#section-3.3-5.1.1" class="pilcrow">¶</a></p>
<p id="section-3.3-5.1.2"><strong>Note:</strong> Although technically there is no need for a UDP/IP underlay if two routers are directly connected, the SCION implementation always uses a UDP/IP underlay in practice. This is to enable a common interface for all routers.<a href="#section-3.3-5.1.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-snapshot-header-step-2"></span><table class="center" id="table-6">
          <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-snapshot-header-step-2" class="selfRef">Snapshot header - step 2</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">R1 -&gt; R2</th>
              <th class="text-left" rowspan="1" colspan="1"> </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">SCION</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 1-2,203.0.113.6 (source endpoint A) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 1-3,192.0.2.7 (dest. endpoint B) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">PATH = <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- <em>IF1</em> (0,i2a) <strong>(i1a,0)</strong>  <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- IF2 (0,i1b) (i3a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Link layer</td>
              <td class="text-left" rowspan="1" colspan="1">SRC=R1, DST=R2</td>
            </tr>
          </tbody>
        </table>
<ul class="normal">
<li class="normal" id="section-3.3-7.1">
            <p id="section-3.3-7.1.1"><em>Step 3</em> <br> <strong>R2-&gt;R3</strong>: When receiving the packet, router R2 of core AS 1 checks whether the packet has been received through the ingress interface i1a as specified by the current hop field. Otherwise, the packet is dropped by router R2. The router notices that it has consumed the last hop field of the current path segment, and hence moves the pointer from the current info field to the next info field <em>IF2</em>. The corresponding current hop field is (0,i1b), which contains egress interface i1b. R2 maps the i1b interface ID to egress router R3, it therefore encapsulates the SCION packet inside an intra-AS underlay IP packet with the address of R3 as the underlay destination.<a href="#section-3.3-7.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-snapshot-header-step-3"></span><table class="center" id="table-7">
          <caption>
<a href="#table-7" class="selfRef">Table 7</a>:
<a href="#name-snapshot-header-step-3" class="selfRef">Snapshot header - step 3</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">R2 -&gt; R3</th>
              <th class="text-left" rowspan="1" colspan="1"> </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">SCION</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 1-2,203.0.113.6 (source endpoint A) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 1-3,192.0.2.7 (dest. endpoint B) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">PATH =  <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- IF1 (0,i2a) (i1a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- <em>IF2</em> <strong>(0,i1b)</strong> (i3a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">UDP</td>
              <td class="text-left" rowspan="1" colspan="1">P<sub>S</sub> = 30041, P<sub>D</sub> = 30041 <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">IP</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 198.51.100.1 (router R2) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 198.51.100.4 (router R3) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Link layer</td>
              <td class="text-left" rowspan="1" colspan="1">SRC=R2, DST=R3</td>
            </tr>
          </tbody>
        </table>
<ul class="normal">
<li class="normal" id="section-3.3-9.1">
            <p id="section-3.3-9.1.1"><em>Step 4</em> <br> <strong>R3-&gt;R4</strong>: Router R3 inspects the current hop field in the SCION header, uses interface i1b to forward the packet to its neighbor SCION router R4 of AS 3, and moves the current hop-field pointer forward. It adds an IP header to reach R4.<a href="#section-3.3-9.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-snapshot-header-step-4"></span><table class="center" id="table-8">
          <caption>
<a href="#table-8" class="selfRef">Table 8</a>:
<a href="#name-snapshot-header-step-4" class="selfRef">Snapshot header - step 4</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">R3 -&gt; R4</th>
              <th class="text-left" rowspan="1" colspan="1"> </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">SCION</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 1-2,203.0.113.6 (source endpoint A) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 1-3,192.0.2.7 (dest. endpoint B) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">PATH =  <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- IF1 (0,i2a) (i1a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- <em>IF2</em> (0,i1b) <strong>(i3a,0)</strong> <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">UDP</td>
              <td class="text-left" rowspan="1" colspan="1">P<sub>S</sub> = 30041, P<sub>D</sub> = 30041 <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">IP</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 1-1,198.51.100.17 (router R3) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 1-3,198.51.100.18 (router R4) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Link layer</td>
              <td class="text-left" rowspan="1" colspan="1">SRC=R3, DST=R4</td>
            </tr>
          </tbody>
        </table>
<ul class="normal">
<li class="normal" id="section-3.3-11.1">
            <p id="section-3.3-11.1.1"><em>Step 5</em> <br> <strong>R4-&gt;B</strong>: SCION router R4 first checks whether the packet has been received through the ingress interface i3a as specified by the current hop field. R4 will then also realize, based on the fields <code>CurrHF</code> and <code>SegLen</code> in the SCION header, that the packet has reached the last hop in its SCION path. Therefore, instead of stepping up the pointers to the next info or hop field, router R4 inspects the SCION destination address and extracts the endpoint address 192.0.2.7. It creates a fresh underlay UDP/IP header with this address as destination and with itself as source. The intra-domain forwarding can now deliver the packet to destination endpoint B.<a href="#section-3.3-11.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-snapshot-header-step-5"></span><table class="center" id="table-9">
          <caption>
<a href="#table-9" class="selfRef">Table 9</a>:
<a href="#name-snapshot-header-step-5" class="selfRef">Snapshot header - step 5</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">R4 -&gt; B</th>
              <th class="text-left" rowspan="1" colspan="1"> </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">SCION</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 1-2,203.0.113.6 (source endpoint A) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 1-3,192.0.2.7 (dest. endpoint B) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">PATH =  <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- IF1 (0,i2a) (i1a,0) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">- <em>IF2</em> (0,i1b) <strong>(i3a,0)</strong> <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">UDP</td>
              <td class="text-left" rowspan="1" colspan="1">P<sub>S</sub> = 30041, P<sub>D</sub> = 30041 <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">IP</td>
              <td class="text-left" rowspan="1" colspan="1">SRC = 192.0.2.34 (router R4) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">DST = 192.0.2.7 (endpoint B) <br>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Link layer</td>
              <td class="text-left" rowspan="1" colspan="1">SRC=R4, DST=B</td>
            </tr>
          </tbody>
        </table>
<p id="section-3.3-13">When destination endpoint B wants to respond to source endpoint A, it can just swap the source and destination addresses in the SCION header, reverse the SCION path, and set the pointers to the info and hop fields at the beginning of the reversed path (see also <a href="#reverse" class="auto internal xref">Section 2.2.3.4</a>).<a href="#section-3.3-13" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="path-auth">
<section id="section-4">
      <h2 id="name-path-authorization-2">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-path-authorization-2" class="section-name selfRef">Path Authorization</a>
      </h2>
<p id="section-4-1">Path authorization guarantees that data packets always traverse the network along paths segments authorized by all on-path ASes in the control plane. In contrast to the IP-based Internet, where forwarding decisions are made by routers based on locally stored information, SCION routers base their forwarding decisions purely on the forwarding information carried in the packet header and set by endpoints.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">SCION uses cryptographic mechanisms to efficiently provide path authorization. The mechanisms are based on <em>symmetric</em> cryptography in the form of Message Authentication Codes (MACs) in the data plane to secure forwarding information encoded in hop fields. This chapter first explains how hop field MACs are computed, then how they are validated as they traverse the network.<a href="#section-4-2" class="pilcrow">¶</a></p>
<div id="auth-chained-macs">
<section id="section-4.1">
        <h3 id="name-authorizing-segments-throug">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-authorizing-segments-throug" class="section-name selfRef">Authorizing Segments through Chained MACs</a>
        </h3>
<p id="section-4.1-1">When authorizing SCION PCBs and path segments in the control plane and forwarding information in the data plane, an AS authenticates not only its own hop information but also an aggregation of all upstream hops. This section describes how this works.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div id="hf-mac-calc">
<section id="section-4.1.1">
          <h4 id="name-hop-field-mac-computation">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-hop-field-mac-computation" class="section-name selfRef">Hop Field MAC Computation</a>
          </h4>
<p id="section-4.1.1-1">The MAC in the hop fields of a SCION path has two purposes:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.1">
              <p id="section-4.1.1-2.1.1">Preventing malicious endpoints from illegally adding, removing, or reordering hops within a path segment created during beaconing in the control plane.<a href="#section-4.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-2.2">
              <p id="section-4.1.1-2.2.1">Authentication of the information contained in the hop field itself, in particular the <code>ExpTime</code>, <code>ConsIngress</code>, and <code>ConsEgress</code>.<a href="#section-4.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.1-3">To fulfill the above purposes, the MAC for the hop field of AS<sub>i</sub> includes both the components of the current hop field HF<sub>i</sub> and an aggregation of the path segment identifier and all preceding hop fields/entries in the path segment. The aggregation is a 16-bit XOR-sum of the path segment identifier and the hop field MACs.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1-4">When originating a path-segment construction beacon PCB in the <strong>control plane</strong>, a core AS chooses a random 16-bit value as segment identifier <code>SegID</code> for the path segment and includes it in the PCB's <code>Segment Info</code> component. In the control plane, each AS<sub>i</sub> on the path segment computes the MAC for the current hop HF<sub>i</sub>, based on the value of <code>SegID</code> and the MACs of the preceding hop entries. Here, the full XOR-sum is computed explicitly.<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1-5">For high-speed packet processing in the <strong>data plane</strong>, computing even cheap operations such as the XOR-sum over a variable number of inputs is complicated, in particular for hardware router implementations. To avoid this overhead for the MAC-chaining in path authorization in the data plane, the XOR-sum is tracked incrementally for each (of the up to three) path segments in a path, as a separate, updatable accumulator field <code>Acc</code>. The routers update the accumulator field <code>Acc</code> by adding/subtracting only a single 16-bit value each.<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1.1-6">When combining path segments to create a path to the destination endpoint, the source endpoint <span class="bcp14">MUST</span> also initialize the value of accumulator field <code>Acc</code> for each path segment. The <code>Acc</code> field <span class="bcp14">MUST</span> contain the correct XOR-sum of the path segment identifier and preceding hop field MACs expected by the first router that is traversed.<a href="#section-4.1.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1.1-7">In the following, the computation of the hop field MAC as well as the accumulator field <code>Acc</code> is explained.<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1.1-8"><strong>Note:</strong> The algorithm used by SCION to compute the hop field MAC is based on the AES-CMAC algorithm, truncated to 48-bits - see also <span>[<a href="#RFC4493" class="cite xref">RFC4493</a>]</span>. In principle, the computation of the MAC is an AS-specific choice; only the control service and routers of the AS need to agree on keys, algorithm, and input for the MAC. However, note that we do not provide nor specify any mechanism to coordinate AS-specific choices between the routers and the control services of the AS.<a href="#section-4.1.1-8" class="pilcrow">¶</a></p>
<div id="def-mac">
<section id="section-4.1.1.1">
            <h5 id="name-mac-definition">
<a href="#section-4.1.1.1" class="section-number selfRef">4.1.1.1. </a><a href="#name-mac-definition" class="section-name selfRef">MAC - Definition</a>
            </h5>
<ul class="normal">
<li class="normal" id="section-4.1.1.1-1.1">
                <p id="section-4.1.1.1-1.1.1">Consider a path segment with "n" hops, containing ASes AS<sub>0</sub>, ... , AS<sub>n-1</sub>, with forwarding keys K<sub>0</sub>, ... , K<sub>n-1</sub> in this order.<a href="#section-4.1.1.1-1.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-1.2">
                <p id="section-4.1.1.1-1.2.1">AS<sub>0</sub> is the core AS that created the PCB representing the path segment and that added a random initial 16-bit segment identifier <code>SegID</code> to the <code>Segment Info</code> field of the PCB.<a href="#section-4.1.1.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.1.1.1-2">The MAC<sub>i</sub> of the hop field of AS<sub>i</sub> is now calculated based on the following definition:<a href="#section-4.1.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.1.1-3">MAC<sub>i</sub> = <br> Ck<sub>i</sub> (<code>SegID</code> XOR MAC<sub>0</sub> [:2] ... XOR MAC<sub>i-1</sub> [:2], Timestamp, ExpTime<sub>i</sub>, ConsIngress<sub>i</sub>, ConsEgress<sub>i</sub>)<a href="#section-4.1.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1.1-4">where<a href="#section-4.1.1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1.1-5.1">
                <p id="section-4.1.1.1-5.1.1">k<sub>i</sub> = The forwarding key k of the current AS<sub>i</sub><a href="#section-4.1.1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-5.2">
                <p id="section-4.1.1.1-5.2.1">Ck<sub>i</sub> (...) = Checksum C over (...) computed with forwarding key k<sub>i</sub><a href="#section-4.1.1.1-5.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-5.3">
                <p id="section-4.1.1.1-5.3.1"><code>SegID</code> = The random initial 16-bit segment identifier set by the core AS when creating the corresponding PCB<a href="#section-4.1.1.1-5.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-5.4">
                <p id="section-4.1.1.1-5.4.1">XOR = The bitwise "exclusive or" operation<a href="#section-4.1.1.1-5.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-5.5">
                <p id="section-4.1.1.1-5.5.1">MAC<sub>i</sub> [:2] = The hop field MAC for AS<sub>i</sub>, truncated to 2 bytes<a href="#section-4.1.1.1-5.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-5.6">
                <p id="section-4.1.1.1-5.6.1">Timestamp = The timestamp set by the core AS when creating the corresponding PCB<a href="#section-4.1.1.1-5.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.1-5.7">
                <p id="section-4.1.1.1-5.7.1">ExpTime<sub>i</sub>, ConsIngress<sub>i</sub>, ConsEgress<sub>i</sub> = The content of the hop field HF<sub>i</sub><a href="#section-4.1.1.1-5.7.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.1.1.1-6">The above definition implies that the current MAC is based on the XOR-sum of the truncated MACs of all preceding hop fields in the path segment as well as the path segment's <code>SegID</code>. In other words, the current MAC is <em>chained</em> to all preceding MACs.<a href="#section-4.1.1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="layout-of-the-input-data-for-the-mac-calculation">
<section id="section-4.1.1.2">
            <h5 id="name-layout-of-the-input-data-fo">
<a href="#section-4.1.1.2" class="section-number selfRef">4.1.1.2. </a><a href="#name-layout-of-the-input-data-fo" class="section-name selfRef">Layout of the Input Data for the MAC Calculation</a>
            </h5>
<p id="section-4.1.1.2-1"><a href="#_figure-17" class="auto internal xref">Figure 17</a> below shows the layout of the input data to calculate the hop field MAC in the data plane. The input layout represents the 8 bytes of the info field and the first 8 bytes of the hop field, with some fields zeroed out.<a href="#section-4.1.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1.2-2">Note that the MAC field itself is only 6 bytes long - see also <a href="#hopfld" class="auto internal xref">Section 2.2.3.2.4</a>.<a href="#section-4.1.1.2-2" class="pilcrow">¶</a></p>
<span id="name-input-data-to-calculate-the"></span><div id="_figure-17">
<figure id="figure-17">
              <div class="alignLeft art-text artwork" id="section-4.1.1.2-3.1">
<pre>
0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -----+
|               0               |           Acc                 |   Hop|
|-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-| Field|
|                           Timestamp                           |      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-| -----+
|       0       |    ExpTime    |          ConsIngress          |  Info|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ Field|
|          ConsEgress           |               0               |      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -----+
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a>:
<a href="#name-input-data-to-calculate-the" class="selfRef">Input data to calculate the hop field MAC</a>
              </figcaption></figure>
</div>
</section>
</div>
<div id="def-acc">
<section id="section-4.1.1.3">
            <h5 id="name-accumulator-acc-definition">
<a href="#section-4.1.1.3" class="section-number selfRef">4.1.1.3. </a><a href="#name-accumulator-acc-definition" class="section-name selfRef">Accumulator Acc - Definition</a>
            </h5>
<p id="section-4.1.1.3-1">The accumulator Acc<sub>i</sub> is an updatable counter introduced in the data plane to reduce overhead caused by MAC-chaining for path authorization. This is achieved by incrementally tracking the XOR-sum of the previous MACs as a separate, updatable accumulator field <code>Acc</code>, which is part of the path segment's info field <code>InfoField</code> in the packet header (see also <a href="#inffield" class="auto internal xref">Section 2.2.3.2.3</a>). Routers update this field by adding/subtracting only a single 16-bit value each.<a href="#section-4.1.1.3-1" class="pilcrow">¶</a></p>
<span id="name-the-info-field-of-a-specifi"></span><div id="_figure-18">
<figure id="figure-18">
              <div class="alignLeft art-text artwork" id="section-4.1.1.3-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|r r r r r r P C|      RSV      |             Acc               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Timestamp                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-18" class="selfRef">Figure 18</a>:
<a href="#name-the-info-field-of-a-specifi" class="selfRef">The Info Field of a specific path segment in the packet header, with the updatable accumulator field `Acc`.</a>
              </figcaption></figure>
</div>
<p id="section-4.1.1.3-3">This is how it works:<a href="#section-4.1.1.3-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-4"><a href="#def-mac" class="auto internal xref">Section 4.1.1.1</a> defines MAC<sub>i</sub> as follows:<a href="#section-4.1.1.3-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-5">MAC<sub>i</sub> = <br> Ck<sub>i</sub> (<code>SegID</code> XOR MAC<sub>0</sub> [:2] ... XOR MAC<sub>i-1</sub> [:2], Timestamp, ExpTime<sub>i</sub>, ConsIngress<sub>i</sub>, ConsEgress<sub>i</sub>)<a href="#section-4.1.1.3-5" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-6">In the data plane, the expression <code>SegID XOR MAC_0 [:2] ... XOR MAC_i-1 [:2]</code> is replaced by Acc<sub>i</sub>. This results in the following alternative procedure for the computation of MAC<sub>i</sub> used in the data plane:<a href="#section-4.1.1.3-6" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-7">MAC<sub>i</sub> = Ck<sub>i</sub> (Acc<sub>i</sub>, Timestamp, ExpTime<sub>i</sub>, ConsIngress<sub>i</sub>, ConsEgress<sub>i</sub>)<a href="#section-4.1.1.3-7" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-8">During forwarding in the data plane, each AS<sub>i</sub> updates the <code>Acc</code> field in the packet header, such, that it contains the correct input value of the Accumulator Acc for the next AS in the path segment to be able to calculate the MAC over its hop field. Note that the correct input value of the <code>Acc</code> field depends on the direction of travel.<a href="#section-4.1.1.3-8" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-9">The value of the accumulator Acc<sub>i+1</sub> is calculated based on the following definition (in the direction of beaconing):<a href="#section-4.1.1.3-9" class="pilcrow">¶</a></p>
<p id="section-4.1.1.3-10">Acc<sub>i+1</sub> = Acc<sub>i</sub> XOR MAC<sub>i</sub> [:2]<a href="#section-4.1.1.3-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1.3-11.1">
                <p id="section-4.1.1.3-11.1.1">XOR = The bitwise "exclusive or" operation<a href="#section-4.1.1.3-11.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1.1.3-11.2">
                <p id="section-4.1.1.3-11.2.1">MAC<sub>i</sub> [:2] = The hop field MAC for the current AS<sub>i</sub>, truncated to 2 bytes<a href="#section-4.1.1.3-11.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="peerlink">
<section id="section-4.1.2">
          <h4 id="name-peering-links">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-peering-links" class="section-name selfRef">Peering Links</a>
          </h4>
<p id="section-4.1.2-1">The above described computation of a hop field MAC does not apply to a peering hop field, i.e., to a hop field that allows transiting from a child interface/link to a peering interface/link.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">The reason for this is that the MACs of the hop fields "after" the peering hop field (in beaconing direction) are not chained to the MAC of the peering hop field, but to the MAC of the main hop field in the corresponding AS entry. To make this work, the MAC of the peering hop field is also chained to the MAC of the main hop field - this allows to validate the chained MAC for both the peering hop field and the following hop fields, by using the same <code>Acc</code> field value.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2-3">This results in the following definition for the calculation of the MAC for a peering hop field.<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<p id="section-4.1.2-4">The Control Plane Internet-Draft defines a peering hop field as follows:<a href="#section-4.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.1.2-5">hop field<sup>Peer</sup><sub>i</sub> = (ExpTime<sup>Peer</sup><sub>i</sub>, ConsIngress<sup>Peer</sup><sub>i</sub>, ConsEgress<sup>Peer</sup><sub>i</sub>, MAC<sup>Peer</sup><sub>i</sub>)<a href="#section-4.1.2-5" class="pilcrow">¶</a></p>
<p id="section-4.1.2-6">This definition, the general definition of a hop field MAC and the explanation above leads to the following definition of the MAC for a peering hop field<sup>Peer</sup><sub>i</sub>:<a href="#section-4.1.2-6" class="pilcrow">¶</a></p>
<p id="section-4.1.2-7">MAC<sup>Peer</sup><sub>i</sub> = <br> Ck<sup>Peer</sup><sub>i</sub> (<code>SegID</code> XOR MAC<sub>0</sub> [:2] ... XOR MAC<sub>i</sub> [:2], Timestamp, ExpTime<sup>Peer</sup><sub>i</sub>, ConsIngress<sup>Peer</sup><sub>i</sub>, ConsEgress<sup>Peer</sup><sub>i</sub>)<a href="#section-4.1.2-7" class="pilcrow">¶</a></p>
<p id="section-4.1.2-8"><strong>Note:</strong> The XOR-sum of the MACs in the formula of the peering hop field <strong>also includes</strong> the MAC of the main hop field (whereas for the calculation of the MAC for the main hop field itself only the XOR-sum of the <em>previous</em> MACs is used).<a href="#section-4.1.2-8" class="pilcrow">¶</a></p>
<p id="section-4.1.2-9"><strong>Note:</strong> The Control-Plane Internet-Draft is available here: <span>[<a href="#I-D.scion-cp" class="cite xref">I-D.scion-cp</a>]</span>.<a href="#section-4.1.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="packet-verif">
<section id="section-4.2">
        <h3 id="name-path-initialization-and-pac">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-path-initialization-and-pac" class="section-name selfRef">Path Initialization and Packet Processing</a>
        </h3>
<p id="section-4.2-1">As is described in <a href="#format" class="auto internal xref">Section 2.1</a>, the path header of the data-plane packets only contains a sequence of info fields and hop fields without any additional data from the corresponding PCBs. Also, the SCION path does not contain any AS numbers (except for the source and destination ASes), and there is no field explicitly defining the type of each segment (up, core, or down). This chapter describes the required steps for the source endpoint and each SCION router to ensure that a data packet only traverses authorized segments. The chapter first specifies the initialization of a path at the source endpoint, followed by the steps that the SCION routers needs to perform when a data-plane packet traverses an AS on its way to the destination.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="initialization-at-source-endpoint">
<section id="section-4.2.1">
          <h4 id="name-initialization-at-source-en">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-initialization-at-source-en" class="section-name selfRef">Initialization at Source Endpoint</a>
          </h4>
<p id="section-4.2.1-1">The source endpoint needs to initialize a path correctly for the SCION routers to be able to verify the hop fields in the data plane. To this end, the source endpoint <span class="bcp14">MUST</span> perform the following steps:<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2.1-2">
<li id="section-4.2.1-2.1">
              <p id="section-4.2.1-2.1.1">Combine the preferred end-to-end path from the path segments obtained during path lookup.<a href="#section-4.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.2.1-2.2">
              <p id="section-4.2.1-2.2.1">Extract the info fields and hop fields from the different path segments that together build the end-to-end path to the destination endpoint. Then insert the relevant information from the path segments' info and hop fields into the corresponding <code>InfoFields</code> and <code>Hopfields</code>, respectively, in the data packet header.<a href="#section-4.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.2.1-2.3">
              <p id="section-4.2.1-2.3.1">Each 8-byte info field <code>InfoField</code> in the packet header contains the updatable <code>Acc</code> field as well as a Peering flag <code>P</code> and a Construction Direction flag <code>C</code> (see also <a href="#inffield" class="auto internal xref">Section 2.2.3.2.3</a>). As a next step in the path initialization process, the source <span class="bcp14">MUST</span> correctly set the flags and the <code>Acc</code> field of all <code>InfoFields</code> included in the path, according to the following rules:<a href="#section-4.2.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2.3.2"><strong>Note:</strong> As already stated above, the type of segment is not visible directly in the forwarding path but can be inferred from flags and other information. See also <a href="#process-router" class="auto internal xref">Section 4.2.2</a>.<a href="#section-4.2.1-2.3.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.3.3.1">
                  <p id="section-4.2.1-2.3.3.1.1">The Construction Direction flag <code>C</code> <span class="bcp14">MUST</span> be set to "1" whenever the corresponding segment is traversed in construction direction, i.e., for down-path segments and potentially for core-segments. It <span class="bcp14">MUST</span> be set to "0" for up-path segments and "reversed" core-segments.<a href="#section-4.2.1-2.3.3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.2.1-2.3.3.2">
                  <p id="section-4.2.1-2.3.3.2.1">The Peering flag <code>P</code> <span class="bcp14">MUST</span> be set to "1" for up- and down-segments if, and only if, the path contains a peering hop field.<a href="#section-4.2.1-2.3.3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.2.1-2.3.3.3">
                  <p id="section-4.2.1-2.3.3.3.1">The field <code>Acc</code> field is an updatable field. It is used to compute the MAC over the current hop field. The value of the field <code>Acc</code> field corresponds to the value of the Accumulator Acc<sub>i</sub> for AS<sub>i</sub>.  It is initialized based on the location of the sender in relation to path construction.<a href="#section-4.2.1-2.3.3.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-4.2.1-2.3.4">
The following <code>InfoField</code> settings are possible, based on the following possible use cases:<a href="#section-4.2.1-2.3.4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.3.5.1">
                  <p id="section-4.2.1-2.3.5.1.1"><strong>Use case 1</strong> <br> The path segment is traversed in construction direction and includes no peering hop field. It starts at the <em>i</em>-th AS of the full segment discovered in beaconing. In this case:<a href="#section-4.2.1-2.3.5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.3.5.1.2.1">
                      <p id="section-4.2.1-2.3.5.1.2.1.1">The Peering flag <code>P</code> = "0"<a href="#section-4.2.1-2.3.5.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.1-2.3.5.1.2.2">
                      <p id="section-4.2.1-2.3.5.1.2.2.1">The Construction Direction flag <code>C</code> = "1"<a href="#section-4.2.1-2.3.5.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.1-2.3.5.1.2.3">
                      <p id="section-4.2.1-2.3.5.1.2.3.1">The value of the <code>Acc</code> = Acc<sub>i</sub>. For more details, see <a href="#def-acc" class="auto internal xref">Section 4.1.1.3</a>.<a href="#section-4.2.1-2.3.5.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.2.1-2.3.5.2">
                  <p id="section-4.2.1-2.3.5.2.1"><strong>Use case 2</strong> <br> The path segment is traversed in construction direction and includes a peering hop field (which is the first hop field of the segment). It starts at the <em>i</em>-th AS of the full segment discovered in beaconing. In this case:<a href="#section-4.2.1-2.3.5.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.3.5.2.2.1">
                      <p id="section-4.2.1-2.3.5.2.2.1.1">The Peering flag <code>P</code> = "1"<a href="#section-4.2.1-2.3.5.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.1-2.3.5.2.2.2">
                      <p id="section-4.2.1-2.3.5.2.2.2.1">The Construction Direction flag <code>C</code> = "1"<a href="#section-4.2.1-2.3.5.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.1-2.3.5.2.2.3">
                      <p id="section-4.2.1-2.3.5.2.2.3.1">The value of the <code>Acc</code> = Acc<sub>i+1</sub>. For more details, see <a href="#def-acc" class="auto internal xref">Section 4.1.1.3</a>.<a href="#section-4.2.1-2.3.5.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.2.1-2.3.5.3">
                  <p id="section-4.2.1-2.3.5.3.1"><strong>Use case 3</strong> <br> The path segment is traversed against construction direction. The full segment has "n" hops. In this case:<a href="#section-4.2.1-2.3.5.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.3.5.3.2.1">
                      <p id="section-4.2.1-2.3.5.3.2.1.1">The Peering flag <code>P</code> = "0" or "1" (depending on whether the last hop field in the up-segment is a peering hop field)<a href="#section-4.2.1-2.3.5.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.1-2.3.5.3.2.2">
                      <p id="section-4.2.1-2.3.5.3.2.2.1">The Construction Direction flag <code>C</code> = "0"<a href="#section-4.2.1-2.3.5.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-4.2.1-2.3.5.3.2.3">
                      <p id="section-4.2.1-2.3.5.3.2.3.1">The value of the <code>Acc</code> = Acc<sub>n-1</sub>. This is because seen from the direction of beaconing, the source endpoint is the last AS in the path segment. For more details, see <a href="#def-mac" class="auto internal xref">Section 4.1.1.1</a> and <a href="#def-acc" class="auto internal xref">Section 4.1.1.3</a>.<a href="#section-4.2.1-2.3.5.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li id="section-4.2.1-2.4">
              <p id="section-4.2.1-2.4.1">Besides setting the flags and the <code>Acc</code> field, the source endpoint <span class="bcp14">MUST</span> also set the pointers in the <code>CurrInf</code> and <code>CurrHF</code> fields of the Path Meta Header <code>PathMetaHdr</code> (see <a href="#PathMetaHdr" class="auto internal xref">Section 2.2.3.2.1</a>). As the source endpoint builds the starting point of the forwarding, both pointers <span class="bcp14">MUST</span> be set to "0".<a href="#section-4.2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="process-router">
<section id="section-4.2.2">
          <h4 id="name-processing-at-routers">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-processing-at-routers" class="section-name selfRef">Processing at Routers</a>
          </h4>
<p id="section-4.2.2-1">During forwarding, each AS<sub>i</sub> verifies the path contained in the packet header with the help of the current value of the MAC in the current hop field, and the current value of the Accumulator in the <code>Acc</code> field of the current info field. Additionally, each AS has to correctly set the value of the Accumulator in the <code>Acc</code> field for the next AS to be able to verify its hop field. The exact operations differ based on the location of the AS on the path.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2.2-2">The processing of SCION packets for ASes where a peering link is crossed between path segments is special cased. A path containing a peering link contains exactly two path segments, one against construction direction (up) and one in construction direction (down). On the path segment against construction direction (up), the peering hop field is the last hop of the segment. In construction direction (down), the peering hop field is the first hop of the segment.<a href="#section-4.2.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2.2-3">The following sections describe the tasks to be performed by the ingress and egress border router of each on-path AS. Each operation is described from the perspective of AS<sub>i</sub>, where i belongs to [0 ... n-1], and n == the number of ASes in the path segment (counted from the first AS in the beaconing direction).<a href="#section-4.2.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2.2-4"><strong>Note:</strong> In this context, a border router is called <strong>ingress</strong> border router when it refers to an entrance border router to an AS, as seen from the direction of travel of the SCION packet. So in the context here, the ingress border router is the <em>(packet) incoming</em> border router. A border router is called <strong>egress</strong> border router when it refers to an exit border router of an AS, as seen from the direction of travel of the SCION packet. So in this context, the egress border router is the <em>(packet) leaving</em> border router.<a href="#section-4.2.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2.2-5">The following figure provides a simplified representation of the processing at routers both in construction direction and against construction direction.<a href="#section-4.2.2-5" class="pilcrow">¶</a></p>
<span id="name-a-simplified-representation"></span><div id="_figure-19">
<figure id="figure-19">
            <div class="alignLeft art-text artwork" id="section-4.2.2-6.1">
<pre>
                              .--.
                             ( RR )  = Router
Processing in                 `--'
construction
direction

      1. Verify MAC of AS1          1. Verify MAC of AS2
      2. Update Acc for AS2         2. Update Acc for AS3
                 |                            |
&gt;&gt;&gt;--------------o----------------------------o----------------------&gt;&gt;&gt;

+-------------+  |           +-------------+  |          +-------------+
|             |              |             |             |             |
|           .--. |          .--.         .--. |         .--.           |
|   AS1    ( RR )o---------( RR )  AS2  ( RR )o--------( RR )  AS3     |
|           `--' |          `--'         `--' |         `--'           |
|             |              |             |             |             |
+-------------+  |           +-------------+  |          +-------------+

                 |                            |
&lt;&lt;&lt;--------------o----------------------------o----------------------&lt;&lt;&lt;
                 |                            |
      1. Update Acc for AS1         1. Update Acc for AS2
      2. Verify MAC of AS1          2. Verify MAC of AS2

                                                      Processing against
                                                            construction
                                                               direction
</pre>
</div>
<figcaption><a href="#figure-19" class="selfRef">Figure 19</a>:
<a href="#name-a-simplified-representation" class="selfRef">A simplified representation of the processing at routers in both directions.</a>
            </figcaption></figure>
</div>
<div id="steps-ingress-border-router">
<section id="section-4.2.2.1">
            <h5 id="name-steps-ingress-border-router">
<a href="#section-4.2.2.1" class="section-number selfRef">4.2.2.1. </a><a href="#name-steps-ingress-border-router" class="section-name selfRef">Steps Ingress Border Router</a>
            </h5>
<p id="section-4.2.2.1-1">This section describes the steps that a SCION ingress border router <span class="bcp14">MUST</span> perform when it receives a SCION packet.<a href="#section-4.2.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2.2.1-2">
<li id="section-4.2.2.1-2.1">
                <p id="section-4.2.2.1-2.1.1">Check that the interface through which the packet was received is equal to the ingress interface in the current hop field.<a href="#section-4.2.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.2.2.1-2.2">
                <p id="section-4.2.2.1-2.2.1">Check that the current hop field is not expired and within its validity period.<a href="#section-4.2.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.2.2.1-2.3">
                <p id="section-4.2.2.1-2.3.1">The next steps depend on the direction of travel and whether this segment includes a peering hop field. Both features are indicated by the settings of the Construction Direction flag <code>C</code> and the Peering flag <code>P</code> in the current info field. Therefore, check the settings of both flags. The following combinations are possible:<a href="#section-4.2.2.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.1-2.3.2.1">
                    <p id="section-4.2.2.1-2.3.2.1.1">The packet traverses the path segment in <strong>construction direction</strong> (<code>C</code> = "1" and <code>P</code> = "0" or "1"). In this case, proceed with step 4.<a href="#section-4.2.2.1-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.2.2.1-2.3.2.2">
                    <p id="section-4.2.2.1-2.3.2.2.1">The packet traverses the path segment <strong>against construction direction</strong> (<code>C</code> = "0"). The following use cases are possible:<a href="#section-4.2.2.1-2.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.1-2.3.2.2.2.1">
                        <p id="section-4.2.2.1-2.3.2.2.2.1.1"><strong>Use case 1</strong> <br> The path segment includes <strong>no peering hop field</strong> (<code>P</code> = "0"). In this case, the ingress border router <span class="bcp14">MUST</span> take the following step(s):<a href="#section-4.2.2.1-2.3.2.2.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.1-2.3.2.2.2.1.2.1">
                            <p id="section-4.2.2.1-2.3.2.2.2.1.2.1.1">Compute the value of the Accumulator Acc as follows:<a href="#section-4.2.2.1-2.3.2.2.2.1.2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.2.2.1-2.3.2.2.2.1.2.1.2">
Acc = Acc<sub>i+1</sub> XOR MAC<sub>i</sub> <br>
where <br>
Acc<sub>i+1</sub> = the current value of the field <code>Acc</code> in the current info field <br>
MAC<sub>i</sub> = the value of MAC<sub>i</sub> in the current hop field representing AS<sub>i</sub><a href="#section-4.2.2.1-2.3.2.2.2.1.2.1.2" class="pilcrow">¶</a></p>
<p id="section-4.2.2.1-2.3.2.2.2.1.2.1.3"><strong>Note:</strong> In the case described here the packet travels against direction of beaconing. That is, the packet comes from AS<sub>i+1</sub> and is going to enter AS<sub>i</sub>. This means that the <code>Acc</code> field of this incoming packet represents the value of Accumulator Acc<sub>i+1</sub>. However, to compute the MAC<sub>i</sub> for the current AS<sub>i</sub>, we need the value of Accumulator Acc<sub>i</sub> (see <a href="#def-acc" class="auto internal xref">Section 4.1.1.3</a>). Because the border router knows that the formula for Acc<sub>i+1</sub> = Acc<sub>i</sub> XOR MAC<sub>i</sub> [:2] (see also <a href="#def-acc" class="auto internal xref">Section 4.1.1.3</a>), and because the values of Acc<sub>i+1</sub> and MAC<sub>i</sub> are known, the router will be able to recover the value Acc<sub>i</sub> based on the just-mentioned formula for Acc.<a href="#section-4.2.2.1-2.3.2.2.2.1.2.1.3" class="pilcrow">¶</a></p>
</li>
                          <li class="normal" id="section-4.2.2.1-2.3.2.2.2.1.2.2">
                            <p id="section-4.2.2.1-2.3.2.2.2.1.2.2.1">Replace the current value of the field <code>Acc</code> in the current info field with the newly calculated value of Acc.<a href="#section-4.2.2.1-2.3.2.2.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                          <li class="normal" id="section-4.2.2.1-2.3.2.2.2.1.2.3">
                            <p id="section-4.2.2.1-2.3.2.2.2.1.2.3.1">Compute the MAC<sup>Verify</sup><sub>i</sub> over the hop field of the current AS<sub>i</sub>. For this, use the formula in <a href="#def-mac" class="auto internal xref">Section 4.1.1.1</a>, but replace <code>SegID XOR MAC_0[:2] ... XOR MAC_i-1 [:2]</code> in the formula with the value of the accumulator Acc as just set in the <code>Acc</code> field in the current info field.<a href="#section-4.2.2.1-2.3.2.2.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                          <li class="normal" id="section-4.2.2.1-2.3.2.2.2.1.2.4">
                            <p id="section-4.2.2.1-2.3.2.2.2.1.2.4.1">Check that the MAC<sub>i</sub> in the current hop field matches the just-calculated MAC<sup>Verify</sup><sub>i</sub>. If yes, it is fine. Otherwise, drop the packet.<a href="#section-4.2.2.1-2.3.2.2.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                          <li class="normal" id="section-4.2.2.1-2.3.2.2.2.1.2.5">
                            <p id="section-4.2.2.1-2.3.2.2.2.1.2.5.1">Check whether the current hop field is the last hop field in the path segment. For this, look at the value of the current <code>SegLen</code> and other metadata in the path meta header. If yes, increment both <code>CurrInf</code> and <code>CurrHF</code> in the path meta header. Proceed with step 4.<a href="#section-4.2.2.1-2.3.2.2.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                        </ul>
</li>
                      <li class="normal" id="section-4.2.2.1-2.3.2.2.2.2">
                        <p id="section-4.2.2.1-2.3.2.2.2.2.1"><strong>Use case 2</strong> <br> The path segment includes a <strong>peering hop field</strong> (<code>P</code> = "1"), but the current hop is <strong>not</strong> the peering hop, that is, the current hop field is <strong>not</strong> the <em>last</em> hop field of the segment, seen from the direction of travel - this can be determined by looking at the value of the current <code>SegLen</code> and other metadata in the path meta header. In this case, the ingress border router needs to perform the steps previously described for the path segment without peering hop field. However, the border router <span class="bcp14">MUST NOT</span> increment <code>CurrInf</code> and <span class="bcp14">MUST NOT</span> increment <code>CurrHF</code> in the path meta header. Proceed with step 4.<a href="#section-4.2.2.1-2.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.2.2.1-2.3.2.2.2.3">
                        <p id="section-4.2.2.1-2.3.2.2.2.3.1"><strong>Use case 3</strong> <br> The path segment includes a <strong>peering hop field</strong> (<code>P</code> = "1"), and the current hop field <em>is</em> the peering hop field. This would be the case if the current hop field is the <em>last</em> hop field of the segment, seen from the direction of travel - to find out whether this is true, check the value of the current <code>SegLen</code> and other metadata in the path meta header. In this case, the ingress border router <span class="bcp14">MUST</span> take the following step(s):<a href="#section-4.2.2.1-2.3.2.2.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.1-2.3.2.2.2.3.2.1">
                            <p id="section-4.2.2.1-2.3.2.2.2.3.2.1.1">Compute MAC<sup>Peer</sup><sub>i</sub>. For this, use the formula in <a href="#peerlink" class="auto internal xref">Section 4.1.2</a>, but replace <code>SegID XOR MAC_0[:2] ... XOR MAC_i [:2]</code> in the formula with the value of the accumulator Acc as set in the <code>Acc</code> field in the current info field (this is the value of the accumulator Acc as it comes with the packet).<a href="#section-4.2.2.1-2.3.2.2.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                          <li class="normal" id="section-4.2.2.1-2.3.2.2.2.3.2.2">
                            <p id="section-4.2.2.1-2.3.2.2.2.3.2.2.1">Check that the MAC<sub>i</sub> in the current hop field matches the just-calculated MAC<sup>Peer</sup><sub>i</sub>. If yes, it is fine. Otherwise, drop the packet.<a href="#section-4.2.2.1-2.3.2.2.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                          <li class="normal" id="section-4.2.2.1-2.3.2.2.2.3.2.3">
                            <p id="section-4.2.2.1-2.3.2.2.2.3.2.3.1">Increment both <code>CurrInf</code> and <code>CurrHF</code> in the path meta header. Proceed with step 4.<a href="#section-4.2.2.1-2.3.2.2.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                        </ul>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li id="section-4.2.2.1-2.4">
                <p id="section-4.2.2.1-2.4.1">Forward the packet to the egress border router (based on the egress interface ID in the current hop field) or to the destination endpoint, if this is the destination AS.<a href="#section-4.2.2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-4.2.2.1-3"><strong>Note:</strong> For more information on the path meta header, see <a href="#PathMetaHdr" class="auto internal xref">Section 2.2.3.2.1</a>.<a href="#section-4.2.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="steps-egress-border-router">
<section id="section-4.2.2.2">
            <h5 id="name-steps-egress-border-router">
<a href="#section-4.2.2.2" class="section-number selfRef">4.2.2.2. </a><a href="#name-steps-egress-border-router" class="section-name selfRef">Steps Egress Border Router</a>
            </h5>
<p id="section-4.2.2.2-1">This section describes the steps that a SCION egress border router <span class="bcp14">MUST</span> perform when it receives a SCION packet.<a href="#section-4.2.2.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2.2.2-2">
<li id="section-4.2.2.2-2.1">
                <p id="section-4.2.2.2-2.1.1">Parse the SCION packet.<a href="#section-4.2.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.2.2.2-2.2">
                <p id="section-4.2.2.2-2.2.1">The next steps depend on the direction of travel and whether this segment includes a peering link. Both features are indicated by the settings of the Construction Direction flag <code>C</code> and the Peering flag <code>P</code> in the currently valid info field. Therefore, first check the settings of both flags. The following use cases are possible:<a href="#section-4.2.2.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.2-2.2.2.1">
                    <p id="section-4.2.2.2-2.2.2.1.1"><strong>Use case 1</strong> <br> The packet traverses the path segment in <strong>construction direction</strong> (<code>C</code> = "1"). The path segment either includes <strong>no peering hop field</strong> (<code>P</code> = "0"), or the path segment does include a <strong>peering hop field</strong> (<code>P</code> = "1"), but the current hop is <strong>not</strong> the peering hop, that is, the current hop field is <strong>not</strong> the <em>first</em> hop field of the segment, seen from the direction of travel. To check whether this is true, look at the value of the current <code>SegLen</code> and other metadata in the path meta header. In this case, the egress border router <span class="bcp14">MUST</span> take the following step(s):<a href="#section-4.2.2.2-2.2.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.2-2.2.2.1.2.1">
                        <p id="section-4.2.2.2-2.2.2.1.2.1.1">Compute MAC<sup>Verify</sup><sub>i</sub> over the hop field of the current AS<sub>i</sub>. For this, use the formula in <a href="#def-mac" class="auto internal xref">Section 4.1.1.1</a>, but replace <code>SegID XOR MAC_0[:2] ... XOR MAC_i-1 [:2]</code> in the formula with the value of the accumulator Acc as set in the <code>Acc</code> field in the current info field.<a href="#section-4.2.2.2-2.2.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.2.2.2-2.2.2.1.2.2">
                        <p id="section-4.2.2.2-2.2.2.1.2.2.1">Check that the just-calculated MAC<sup>Verify</sup><sub>i</sub> matches MAC<sub>i</sub> in the hop field of the current AS<sub>i</sub>. If yes, it is fine. Otherwise, drop the packet.<a href="#section-4.2.2.2-2.2.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.2.2.2-2.2.2.1.2.3">
                        <p id="section-4.2.2.2-2.2.2.1.2.3.1">Compute the value of Acc<sub>i+1</sub>. For this, use the formula in <a href="#def-acc" class="auto internal xref">Section 4.1.1.3</a>. Replace Acc<sub>i</sub> in the formula with the current value of the accumulator Acc as set in the <code>Acc</code> field of the current info field.<a href="#section-4.2.2.2-2.2.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.2.2.2-2.2.2.1.2.4">
                        <p id="section-4.2.2.2-2.2.2.1.2.4.1">Replace the value of the <code>Acc</code> field in the current info field with the just-calculated value of Acc<sub>i+1</sub>.<a href="#section-4.2.2.2-2.2.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.2.2.2-2.2.2.1.2.5">
                        <p id="section-4.2.2.2-2.2.2.1.2.5.1">Proceed with step 3.<a href="#section-4.2.2.2-2.2.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                    </ul>
</li>
                  <li class="normal" id="section-4.2.2.2-2.2.2.2">
                    <p id="section-4.2.2.2-2.2.2.2.1"><strong>Use case 2</strong> <br> The packet traverses the path segment in <strong>construction direction</strong> (<code>C</code> = "1"). The path segment includes a <strong>peering hop field</strong> (<code>P</code> = "1"), and the current hop field <em>is</em> the peering hop field. This would be the case if the current hop field is the <em>first</em> hop field of the segment, seen from the direction of travel - to find out whether this is true, check the value of the current <code>SegLen</code> and other metadata in the path meta header. In this case, the egress border router <span class="bcp14">MUST</span> take the following steps:<a href="#section-4.2.2.2-2.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2.2-2.2.2.2.2.1">
                        <p id="section-4.2.2.2-2.2.2.2.2.1.1">Compute MAC<sup>Peer</sup><sub>i</sub>. For this, use the formula in <a href="#peerlink" class="auto internal xref">Section 4.1.2</a>, but replace <code>SegID XOR MAC_0 [:2] ... XOR MAC_i [:2]</code> with the value in the <code>Acc</code> field of the current info field.<a href="#section-4.2.2.2-2.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li class="normal" id="section-4.2.2.2-2.2.2.2.2.2">
                        <p id="section-4.2.2.2-2.2.2.2.2.2.1">Check that the MAC<sub>i</sub> in the hop field of the current AS<sub>i</sub> matches the just-calculated MAC<sup>Peer</sup><sub>i</sub>. If yes, it is fine - proceed with step 3. Otherwise, drop the packet.<a href="#section-4.2.2.2-2.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                    </ul>
</li>
                  <li class="normal" id="section-4.2.2.2-2.2.2.3">
                    <p id="section-4.2.2.2-2.2.2.3.1"><strong>Use case 3</strong> <br> The packet traverses the path segment <strong>against construction direction</strong> (<code>C</code> = "0" and <code>P</code> = "0" or "1"). In this case, proceed with the next step, step 3.<a href="#section-4.2.2.2-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li id="section-4.2.2.2-2.3">
                <p id="section-4.2.2.2-2.3.1">Increment <code>CurrHF</code> in the path meta header.<a href="#section-4.2.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-4.2.2.2-2.4">
                <p id="section-4.2.2.2-2.4.1">Forward the packet to the neighbor AS.<a href="#section-4.2.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-4.2.2.2-3"><strong>Note:</strong> For more information on the path meta header, see <a href="#PathMetaHdr" class="auto internal xref">Section 2.2.3.2.1</a>.<a href="#section-4.2.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">This section describes the possible security risks and attacks that SCION's data plane may be prone to, and how these attacks may be mitigated. It first discusses security risks that pertain to path authorization, followed by a section on other forwarding-related security considerations.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="path-authorization-1">
<section id="section-5.1">
        <h3 id="name-path-authorization-3">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-path-authorization-3" class="section-name selfRef">Path Authorization</a>
        </h3>
<p id="section-5.1-1">A central property of the SCION path-aware data plane is path authorization. Path authorization guarantees that data packets always traverse the network along path segments authorized in the control plane by all on-path ASes. This section discusses how an adversary may attempt to violate the path-authorization property, as well as SCION's prevention mechanisms to these attacks; either an attacker can attempt to create unauthorized hop fields, or they can attempt to create illegitimate paths assembled from authentic individual hop fields.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The main protection mechanism here is the hop field MAC (see <a href="#auth-chained-macs" class="auto internal xref">Section 4.1</a>), authenticating the hop field content, consisting of ingress/egress interface identifiers, creation and expiration timestamp and, virtually, the preceding hop field MACs in the path segment.
Recall that each hop field MAC is computed using the respective AS's secret forwarding key, which is shared across the SCION routers and control plane services within each AS.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div id="forwarding-key-compromise">
<section id="section-5.1.1">
          <h4 id="name-forwarding-key-compromise">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-forwarding-key-compromise" class="section-name selfRef">Forwarding key compromise</a>
          </h4>
<p id="section-5.1.1-1">For the current default MAC algorithm, AES-CMAC truncated to 48 bits, key recovery attacks from (any number of) known plaintext/MAC combinations is computationally infeasible, as far as publicly known.
In addition, the MAC algorithm can be freely chosen by each AS, enabling algorithmic agility for MAC computations. Should a MAC algorithm be discovered to be weak or insecure, each AS can quickly switch to a secure algorithm without the need for coordination with other ASes.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2">A more realistic risk to the secrecy of the forwarding key is exfiltration from a compromised router or control plane service.
An AS can optionally rotate its forwarding key at regular intervals to limit the exposure after a temporary device compromise. However, as is perhaps self-evident, such a key rotation scheme cannot mitigate the impact of an undiscovered, permanent compromise of a device.<a href="#section-5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="forging-hop-field-mac">
<section id="section-5.1.2">
          <h4 id="name-forging-hop-field-mac">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-forging-hop-field-mac" class="section-name selfRef">Forging hop field MAC</a>
          </h4>
<p id="section-5.1.2-1">As a second method to break path authorization is to directly forge a hop field in an online attack, using the router as an oracle to determine the validity of the hop field MAC. The adversary needs to send one packet per guess for verification. For a 6-byte MAC, the adversary would need an expected 2<sup>47</sup> (~140 trillion) tries to successfully forge the MAC of a single hop field.
As the router only checks MACs during the encoded validity period of the hop field, which is limited by the packet header format to at most 24 hours, these tries need to occur in a limited time period. This results in a seemingly infeasible number of ~1.6e9 guesses per second.
In the unlikely case that an online brute-force attack succeeds, the obtained hop field can be used until its inevitable expiration after the just mentioned 24 hour limit.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-splicing">
<section id="section-5.1.3">
          <h4 id="name-path-splicing">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-path-splicing" class="section-name selfRef">Path Splicing</a>
          </h4>
<p id="section-5.1.3-1">In a path-splicing attack, an adversary source endpoint takes valid hop fields of multiple path segments and splices them together to obtain a new unauthorized path. However, SCION’s MAC-chaining mechanism prevents from this kind of attacks. MAC validation for spliced segments would fail at SCION routers and the corresponding packets would be dropped. For details, see <a href="#auth-chained-macs" class="auto internal xref">Section 4.1</a>.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="on-path-attacks">
<section id="section-5.2">
        <h3 id="name-on-path-attacks">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-on-path-attacks" class="section-name selfRef">On-Path Attacks</a>
        </h3>
<p id="section-5.2-1">When an adversary sits on the path between the source and destination endpoint, it is able to intercept the data packets that are being forwarded. This would allow the adversary to hijack traffic onto a path that is different from the intended one selected by the source endpoint. Possible on-path attacks in the data plane are modifications of the SCION path header and SCION address header. In addition, an on-path adversary can always simply drop packets. This kind of attack is fundamental and generally cannot be prevented. However, in this case, the endpoint can use SCION's path-awareness to immediately select an alternate path if available.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div id="modification-of-the-path-header">
<section id="section-5.2.1">
          <h4 id="name-modification-of-the-path-he">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-modification-of-the-path-he" class="section-name selfRef">Modification of the Path Header</a>
          </h4>
<p id="section-5.2.1-1">An on-path adversary could modify the SCION path header, and replace the remaining part of path segments to the destination with different segments. Such replaced segments must include authorized segments, as otherwise the packet would be simply dropped on its way to the destination. The already traversed portion of the current segment and past segments can also be modified by the adversary (for instance, deleting and adding valid and invalid hop fields). On reply packets from the destination, the adversary can transparently revert the changes to the path header again. For instance, if an adversary M is an intermediate AS on the path of a packet from A to B, then M can replace the packet’s past path (leading up to, but not including M). The new path may not be a valid end-to-end path. However, when B reverses the path and sends a reply packet, that packet would go via M, which can then transparently change the invalid path back to the valid path to A. In addition, the endpoint address header can also be modified.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2">Modifications of the SCION path and address header can be discovered by the destination endpoint by a data integrity protection system. Such a data integrity protection system, loosely analogous to the IPSec Authentication Header, exists for SCION but is out of scope for this document. This is described as the SCION Packet Authentication Option (SPAO) in <span>[<a href="#CHUAT22" class="cite xref">CHUAT22</a>]</span>.<a href="#section-5.2.1-2" class="pilcrow">¶</a></p>
<p id="section-5.2.1-3">Moreover, packet integrity protection is not enough if there are two colluding adversaries on the path. These colluding adversaries can forward the packet between them using a different path than selected by the source endpoint: The first on-path attacker remodels the packet header arbitrarily, and the second on-path attacker changes the path back to the original source-selected path, such that the integrity check by the destination endpoint succeeds. To prevent this attack and to defend against multiple on-path adversaries in general, proof of transit is required, which is not in scope for this document.<a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="off-path-attacks">
<section id="section-5.3">
        <h3 id="name-off-path-attacks">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-off-path-attacks" class="section-name selfRef">Off-Path Attacks</a>
        </h3>
<p id="section-5.3-1">SCION's path-awareness limits the abilities of an off-path adversary to influence forwarding in the data plane. Once a packet is "in flight", it will follow its set route, no matter what an adversary may do.
An adversary can attempt to disrupt the connectivity of said path by flooding a link with excessive traffic (see <a href="#dos" class="auto internal xref">Section 5.4</a> below). After detecting congestion, the endpoint can switch to another, non-congested path for subsequent packets.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dos">
<section id="section-5.4">
        <h3 id="name-volumetric-denial-of-servic">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-volumetric-denial-of-servic" class="section-name selfRef">Volumetric Denial of Service Attacks</a>
        </h3>
<p id="section-5.4-1">An adversary can attempt to disrupt the connectivity of a network path by flooding a link with excessive traffic. In this case, the endpoint can switch to another, non-congested path for subsequent packets.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">SCION provides protection against certain reflection-based DoS attacks. Here, the adversary sends requests to a server with the source address set to the address of the victim. The server will send a reply, typically larger than the request, to the victim. As long as the attacker and the victim are located in different ASes, this can be prevented in SCION. The reply packets are simply returned along reversed path to the actual sender, regardless of the source address information. Thus, the reflected will be forwarded to the attackers AS (where it will be discarded because the destination AS does not match).<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">On the flip side, the path choice of the endpoint may possibly be exploited by an attacker to create intermittent congestion with relatively low send rate; the attacker can abuse the latency differences of the available paths, sending at precisely timed intervals to cause short, synchronized bursts of packets near the victim.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<p id="section-5.4-4"><strong>Note</strong> that SCION does not protect against two other types of DoS attacks, namely transport protocol attacks and application layer attacks. Such attacks are out of SCION's scope. However, the additional information contained in the SCION header enables more targeted filtering, e.g., by ISD, AS or path length.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">This document has no IANA actions.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The SCION AS and ISD number are SCION-specific numbers. They are currently allocated by Anapaya Systems, a provider of SCION-based networking software and solutions (see <a href="https://docs.anapaya.net/en/latest/resources/isd-as-assignments/">Anapaya ISD AS assignments</a>). This task is currently being transitioned from Anapaya to the SCION Association.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.scion-cp">[I-D.scion-cp]</dt>
        <dd>
<span class="refAuthor">de Kater, C.</span>, <span class="refAuthor">Rustignoli, N.</span>, and <span class="refAuthor">S. Hitz</span>, <span class="refTitle">"SCION Control Plane"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-dekater-scion-controlplane/">https://datatracker.ietf.org/doc/draft-dekater-scion-controlplane/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1122">[RFC1122]</dt>
        <dd>
<span class="refAuthor">Braden, R., Ed.</span>, <span class="refTitle">"Requirements for Internet Hosts - Communication Layers"</span>, <span class="seriesInfo">STD 3</span>, <span class="seriesInfo">RFC 1122</span>, <span class="seriesInfo">DOI 10.17487/RFC1122</span>, <time datetime="1989-10" class="refDate">October 1989</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1122">https://www.rfc-editor.org/rfc/rfc1122</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1918">[RFC1918]</dt>
        <dd>
<span class="refAuthor">Rekhter, Y.</span>, <span class="refAuthor">Moskowitz, B.</span>, <span class="refAuthor">Karrenberg, D.</span>, <span class="refAuthor">de Groot, G. J.</span>, and <span class="refAuthor">E. Lear</span>, <span class="refTitle">"Address Allocation for Private Internets"</span>, <span class="seriesInfo">BCP 5</span>, <span class="seriesInfo">RFC 1918</span>, <span class="seriesInfo">DOI 10.17487/RFC1918</span>, <time datetime="1996-02" class="refDate">February 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1918">https://www.rfc-editor.org/rfc/rfc1918</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2474">[RFC2474]</dt>
        <dd>
<span class="refAuthor">Nichols, K.</span>, <span class="refAuthor">Blake, S.</span>, <span class="refAuthor">Baker, F.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"</span>, <span class="seriesInfo">RFC 2474</span>, <span class="seriesInfo">DOI 10.17487/RFC2474</span>, <time datetime="1998-12" class="refDate">December 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2474">https://www.rfc-editor.org/rfc/rfc2474</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2711">[RFC2711]</dt>
        <dd>
<span class="refAuthor">Partridge, C.</span> and <span class="refAuthor">A. Jackson</span>, <span class="refTitle">"IPv6 Router Alert Option"</span>, <span class="seriesInfo">RFC 2711</span>, <span class="seriesInfo">DOI 10.17487/RFC2711</span>, <time datetime="1999-10" class="refDate">October 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2711">https://www.rfc-editor.org/rfc/rfc2711</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3168">[RFC3168]</dt>
        <dd>
<span class="refAuthor">Ramakrishnan, K.</span>, <span class="refAuthor">Floyd, S.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time datetime="2001-09" class="refDate">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3168">https://www.rfc-editor.org/rfc/rfc3168</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4493">[RFC4493]</dt>
        <dd>
<span class="refAuthor">Song, JH.</span>, <span class="refAuthor">Poovendran, R.</span>, <span class="refAuthor">Lee, J.</span>, and <span class="refAuthor">T. Iwata</span>, <span class="refTitle">"The AES-CMAC Algorithm"</span>, <span class="seriesInfo">RFC 4493</span>, <span class="seriesInfo">DOI 10.17487/RFC4493</span>, <time datetime="2006-06" class="refDate">June 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4493">https://www.rfc-editor.org/rfc/rfc4493</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5880">[RFC5880]</dt>
        <dd>
<span class="refAuthor">Katz, D.</span> and <span class="refAuthor">D. Ward</span>, <span class="refTitle">"Bidirectional Forwarding Detection (BFD)"</span>, <span class="seriesInfo">RFC 5880</span>, <span class="seriesInfo">DOI 10.17487/RFC5880</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5880">https://www.rfc-editor.org/rfc/rfc5880</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5881">[RFC5881]</dt>
        <dd>
<span class="refAuthor">Katz, D.</span> and <span class="refAuthor">D. Ward</span>, <span class="refTitle">"Bidirectional Forwarding Detection (BFD) for IPv4 and IPv6 (Single Hop)"</span>, <span class="seriesInfo">RFC 5881</span>, <span class="seriesInfo">DOI 10.17487/RFC5881</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5881">https://www.rfc-editor.org/rfc/rfc5881</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
        <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8200">https://www.rfc-editor.org/rfc/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9473">[RFC9473]</dt>
      <dd>
<span class="refAuthor">Enghardt, R.</span> and <span class="refAuthor">C. Krähenbühl</span>, <span class="refTitle">"A Vocabulary of Path Properties"</span>, <span class="seriesInfo">RFC 9473</span>, <span class="seriesInfo">DOI 10.17487/RFC9473</span>, <time datetime="2023-09" class="refDate">September 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9473">https://www.rfc-editor.org/rfc/rfc9473</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="CHUAT22">[CHUAT22]</dt>
        <dd>
<span class="refAuthor">Chuat, L.</span>, <span class="refAuthor">Legner, M.</span>, <span class="refAuthor">Basin, D.</span>, <span class="refAuthor">Hausheer, D.</span>, <span class="refAuthor">Hitz, S.</span>, <span class="refAuthor">Mueller, P.</span>, and <span class="refAuthor">A. Perrig</span>, <span class="refTitle">"The Complete Guide to SCION"</span>, <span class="seriesInfo">ISBN 978-3-031-05287-3</span>, <time datetime="2022" class="refDate">2022</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-031-05288-0">https://doi.org/10.1007/978-3-031-05288-0</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.scion-components">[I-D.scion-components]</dt>
        <dd>
<span class="refAuthor">Rustignoli, N.</span> and <span class="refAuthor">C. de Kater</span>, <span class="refTitle">"SCION Components Analysis"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-rustignoli-panrg-scion-components/">https://datatracker.ietf.org/doc/draft-rustignoli-panrg-scion-components/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.scion-cppki">[I-D.scion-cppki]</dt>
        <dd>
<span class="refAuthor">de Kater, C.</span>, <span class="refAuthor">Rustignoli, N.</span>, and <span class="refAuthor">S. Hitz</span>, <span class="refTitle">"SCION Control-Plane PKI"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-dekater-scion-pki/">https://datatracker.ietf.org/doc/draft-dekater-scion-pki/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.scion-overview">[I-D.scion-overview]</dt>
        <dd>
<span class="refAuthor">de Kater, C.</span>, <span class="refAuthor">Rustignoli, N.</span>, and <span class="refAuthor">A. Perrig</span>, <span class="refTitle">"SCION Overview"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-dekater-panrg-scion-overview/">https://datatracker.ietf.org/doc/draft-dekater-panrg-scion-overview/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SCMP">[SCMP]</dt>
      <dd>
<span class="refAuthor">Anapaya</span>, <span class="refAuthor">ETH</span>, and <span class="refAuthor">SCION</span>, <span class="refTitle">"SCMP Documentation"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://docs.scion.org/en/latest/protocols/scmp.html">https://docs.scion.org/en/latest/protocols/scmp.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">Many thanks go to Matthias Frei (SCION Association), Juan A. Garcia Prado (ETH Zurich), Kevin Meynell (SCION Association) and Jean-Christophe Hugly (SCION Association) for reviewing this document. We are also very grateful to Adrian Perrig (ETH Zurich), for providing guidance and feedback about each aspect of SCION. Finally, we are indebted to the SCION development teams of Anapaya and ETH Zurich, for their practical knowledge and for the documentation about the SCION Data Plane, as well as to the authors of <span>[<a href="#CHUAT22" class="cite xref">CHUAT22</a>]</span> - the book is an important source of input and inspiration for this draft.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protnum">
<section id="appendix-B">
      <h2 id="name-assigned-scion-protocol-num">
<a href="#name-assigned-scion-protocol-num" class="section-name selfRef">Assigned SCION Protocol Numbers</a>
      </h2>
<p id="appendix-B-1">This appendix lists the assigned SCION protocol numbers.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="considerations">
<section id="appendix-B.1">
        <h3 id="name-considerations">
<a href="#name-considerations" class="section-name selfRef">Considerations</a>
        </h3>
<p id="appendix-B.1-1">SCION attempts to take the IANA's assigned Internet protocol numbers into consideration. Widely employed protocols have the same protocol number as the one assigned by IANA. SCION specific protocol numbers start at 200.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<p id="appendix-B.1-2">The protocol numbers are used in the SCION header to identify the upper layer protocol.<a href="#appendix-B.1-2" class="pilcrow">¶</a></p>
<p id="appendix-B.1-3">SCMP refers to the SCION Control Message Protocol, used for diagnostics and error messages. Support for this protocol is optional. A work-in-progress specification is available at: <span>[<a href="#SCMP" class="cite xref">SCMP</a>]</span>.<a href="#appendix-B.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="assignment">
<section id="appendix-B.2">
        <h3 id="name-assignment">
<a href="#name-assignment" class="section-name selfRef">Assignment</a>
        </h3>
<span id="name-the-assigned-scion-protocol"></span><table class="center" id="table-10">
          <caption>
<a href="#table-10" class="selfRef">Table 10</a>:
<a href="#name-the-assigned-scion-protocol" class="selfRef">The assigned SCION protocol numbers</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Decimal</th>
              <th class="text-left" rowspan="1" colspan="1">Keyword</th>
              <th class="text-left" rowspan="1" colspan="1">Protocol</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0-5</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">6</td>
              <td class="text-left" rowspan="1" colspan="1">TCP/SCION</td>
              <td class="text-left" rowspan="1" colspan="1">Transmission Control Protocol over SCION</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">7-16</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">17</td>
              <td class="text-left" rowspan="1" colspan="1">UDP/SCION</td>
              <td class="text-left" rowspan="1" colspan="1">User Datagram Protocol over SCION</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">18-199</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">200</td>
              <td class="text-left" rowspan="1" colspan="1">HBH</td>
              <td class="text-left" rowspan="1" colspan="1">SCION Hop-by-Hop Options</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">201</td>
              <td class="text-left" rowspan="1" colspan="1">E2E</td>
              <td class="text-left" rowspan="1" colspan="1">SCION End-to-End Options</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">202</td>
              <td class="text-left" rowspan="1" colspan="1">SCMP</td>
              <td class="text-left" rowspan="1" colspan="1">SCION Control Message Protocol</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">203</td>
              <td class="text-left" rowspan="1" colspan="1">BFD/SCION</td>
              <td class="text-left" rowspan="1" colspan="1">BFD over SCION</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">204-252</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">253</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Use for experimentation and testing</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">254</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Use for experimentation and testing</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">255</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">Reserved</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Corine de Kater</span></div>
<div dir="auto" class="left"><span class="org">SCION Association</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:c_de_kater@gmx.ch" class="email">c_de_kater@gmx.ch</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nicola Rustignoli</span></div>
<div dir="auto" class="left"><span class="org">SCION Association</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:nic@scion.org" class="email">nic@scion.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Samuel Hitz</span></div>
<div dir="auto" class="left"><span class="org">Anapaya Systems</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hitz@anapaya.net" class="email">hitz@anapaya.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
